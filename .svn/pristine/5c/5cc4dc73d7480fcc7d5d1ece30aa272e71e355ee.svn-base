<!DOCTYPE HTML>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<html lang="en">
<c:set var="base_path" value="${pageContext.request.contextPath}"/>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>球队管理</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!--为了让 Bootstrap 开发的网站对移动设备友好，确保适当的绘制和触屏缩放，需要在网页的 head 之中添加 viewport meta 标签，-->
  <link href="${base_path}/resources/css/team/bootstrap.min.css" rel="stylesheet">
  <link href="${base_path}/resources/lib/layer/theme/default/layer.css" rel="stylesheet">
  <!-- 新 Bootstrap 核心 CSS 文件 -->
  <link rel="stylesheet" type="text/css" href="${base_path}/resources/css/team/style.1.0.css"/>

</head>

<body>

<nav class="nav-bg navbar" >
  <div class="container">
    <div class="logo-w span3 ">
      <img src="${base_path}/resources/img/team/logo足球项目组.png"/>
      <span>四川省青少年校园足球信息网</span>
    </div>
    <div class="nav-w span9">
      <ul>
        <li><a href="#">赛事赛程</a></li>
        <li><a href="#">教练管理</a></li>
        <li><a href="#">球员管理</a></li>
        <li><a href="#">球队管理</a></li>
        <li><a href="#">个人中心</a></li>
      </ul>
    </div>
  </div>
</nav>

<div id="info" class="container" style="width:1002px;">
  <ul class="breadcrumb">
    <li class="active">球队预览<span class="divider">/</span></li>
    <li><a href="${base_path}/team/create">球队创建</a></li>
  </ul>
  <!--导航结束-->
  <table class="table table-hover " >
    <tr class="info">
      <th>编号</th>
      <th>队名</th>
      <th>教练编号</th>
      <th>人数</th>
      <th>状态</th>
      <th  style="text-align:center">操作</th>
    </tr>
    <tbody id="tableStyle">

    </tbody>


  </table>
  <center>
    <div class="pagination">
      <ul id="ulList">
      </ul>
    </div>
  </center>
</div>
<!--container end-->
<!-- 模态框3Modal 开始-->
<div id="myModal3" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel">球队信息</h3>
  </div>
  <div class="modal-body">
    <div class="span6">
      <table class="table table-bordered " id="messageCard">
        <tr class="success">
          <td>基本信息</td>
        </tr>
        <tr>
          <td>
            <p><span class="muted">队 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名:</span>
              <input id="teamName" type="text" style="height:20px;width:190px;" value=""></p>
            <p><span class="muted">球队类型:</span>
              <%--<select id="myInput" style="width:204px;">
                <option id="type" value=""></option>
                </select>--%>
              <input id="type" type="text" style="height:20px;width:190px;" value="">
            </p>
            <p></p><span id="staus" class="muted">球队状态:</span>
            <input type="radio" name="TEAM_STATUS" checked="checked" value="在役"> 在役
            <input type="radio" name="TEAM_STATUS" value="退役"> 退役
            </p>
            <p><span class="muted">球队编号: </span><span id="idTeam"  ></span></p>
            <p><span class="muted">创建时间: </span><span id="createTeam"></span></p>
          </td>
        </tr>
      </table>
    </div>

    <div class="span6">
      <table class="table table-bordered table-hover messageCard">
        <tr class="success">
          <td>教练信息</td>
        </tr>
        <tr>
          <td>
           <%-- <div style="width:50%;float:left;">
            <p style="margin-top:6px;"><span class="muted">姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名: <span id="coachName"></span></span></p>
            <p style="margin-top:32px;"><span class="muted">教练编号:</span><span id="idCoach"></span></p>
            </div>
            <div style="width:50%;float:right;">
            <p style="margin-top:32px;">
              <span class="muted" >年&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;龄: <span id="coachAge"></span></span>
            </p>
            <p style="margin-top:20px;">
              <span class="muted" >年&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;龄: <span id="coachAge"></span></span>
            </p>
            </div>--%>


            <div style="width:50%;float:left;">
              <p style="margin-top:6px;">
                <span class="muted" >姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名: <span id="coachName"></span></span>
              </p>
              <p style="margin-top:32px;">
                <span class="muted" >年&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;龄: <span id="coachAge"></span></span>
              </p>
            </div>
            <div style="width:50%;float:right;">
              <p style="margin-top:6px;">
                <span class="muted" >性&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;别: <span id="coachSex"></span></span>
              </p>
              <p style="margin-top:32px;"><span class="muted" >教练编号:<span id="idCoach"></span></span></p>
            </div>
          </td>

        </tr>
      </table>
    </div>


    <div class="span6">
      <table class="table table-bordered " id="messageCard">
        <tr class="success">
          <td>球员信息</td>
        </tr>
        <tr>
          <td>
            <div class="row" >

            </div>
          </td>
        </tr>
      </table>
    </div>

  </div><!--中部结束-->
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
  </div>
</div><!-- 模态框3Modal 结束-->
<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
<script src="${base_path}/resources/lib/html5shiv.min.js"></script>
<script src="${base_path}/resources/lib/respond.min.js"></script>
<%--<script src="${base_path}/resources/lib/jquery/jquery-3.1.1.min.js "></script>--%>
<script src="${base_path}/resources/lib/jquery/jquery-1.11.3.js "></script>
<script src="${base_path}/resources/lib/layer/layer.js "></script>
<!-- <script src="js/jquery-3.1.1.min.js"></script> -->
<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="${base_path}/resources/js/team/bootstrap.min.js"></script>

</body>
<script type="text/javascript">
  $(document).ready(function () {
      var  pn = 1;
      load(1);
      //查看事件
      $("#tableStyle").on('click','.look',function () {
          $(".row").empty();
          var  td = $(this).parents("#first").children().eq(0).text();
            $.ajax({
                type:"post",
                url:"${base_path}/display/teamInfo?idTeam=" + td+"&time="+Math.random(),
                success:function (result) {

                        $("#teamName").val(result.data.team.name);
                        $("#idTeam").text(result.data.team.idTeam);
                        var realType = "";
                        var type = result.data.team.type;

                        switch (type) {
                            case 1:
                                realType = "小学一年级";
                                break;
                            case 2:
                                realType = "小学二年级";
                                break;
                            case 3:
                                realType = "小学三年级";
                                break;
                            case 4:
                                realType = "小学四年级";
                                break;
                            case 5:
                                realType = "小学五年级";
                                break;
                            case 6:
                                realType = "小学六年级";
                                break;
                            case 7:
                                realType = "初中一年级";
                                break;
                            case 8:
                                realType = "初中二年级";
                                break;
                            case 9:
                                realType = "初中三年级";
                                break;
                            case 10:
                                realType = "混合年级";
                                break;
                            case 11:
                                realType = "混合校级";
                                break;
                        }
                        var time = result.data.team.createTime;
                        var realTime = new Date(time);
                        var year = realTime.getFullYear();
                        var month = realTime.getMonth();
                        var day = realTime.getDay();
                        var hour = realTime.getHours();
                        var min = realTime.getMinutes();
                        var ss = realTime.getSeconds();

                        var datime = year + "/" + month + "/" + day + "    " + hour + ":" + min + ":" + ss;

                        $("#type").val(realType);
                        $("#createTeam").text(datime);

                        //todo还要存储教练名称
                        if (result.data.coach != null) {
                            $("#coachAge").text(result.data.coach.age);
                            $("#coachSex").text(result.data.sex);
                            $("#coachName").text(result.data.coach.name);
                            $("#idCoach").text(result.data.coach.idCoach);
                        }
                        else {
                            $("#coachName").text("未添加教练");
                            $("#coachName").css("color", "red");
                        }
                        var row = $(".row");

                        if (result.data.playerId.length != 0) {
                            for (var i = 0; i < result.data.playerId.length; i++) {
                                var div = $("<div class=\"zhazhazha\" ></div>");
                                var img = $("<img class=\"clo\" src=\"../../../resources/img/22.png\" style=\"width:100%;\">");
                                var nameSpan = $("<span></span>");
                                nameSpan.text(result.data.players[i].name);
                                var playerIdSpan = $("<span id=\"idPlayer\"></span>");
                                playerIdSpan.text(result.data.players[i].idPlayer);
                                var p = $("<p class=\"muted zhazhahui\" ></p>");
                                var br = $("<br>");
                                playerIdSpan.text(result.data.playerId[i]);
                                p.append(nameSpan);
                                p.append(br);
                                p.append(playerIdSpan);
                                div.append(img);
                                div.append(p);
                                row.append(div);
                            }
                        } else {

                            row.append("<div style='color: red'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;未添加球员!!!</div>");
                        }

                },
                error:(function (error) {
                    console.log(error);
                })
            });
          $(this).attr("href","#myModal3");



      });

    //修改事件
      $("#tableStyle").on('click','.update',function () {
          var  td = $(this).parents("#first").children().eq(0).text();
          window.location.href="${base_path}/updateTeam/index?idTeam="+td;
      });



//解散事件
      $("#tableStyle").on('click','.fire',function () {
          var  td = $(this).parents("#first").children().eq(0).text();
          layer.confirm('确认解散吗？',{ btn: ['确定', '取消']},
          function (index) {
              var  flag = false ;
                $.ajax({
                  type:"post",
                  url: "${base_path}/breakTeam/index?idTeam="+td+"&time="+Math.random(),
                  success:function (result) {
                      if (result.status ==0){
                          layer.alert("解散成功");
                          window.load(1);
                      }else {
                          layer.alert("解散失败");
                      }
                  },
                 error:function (error) {
                     console.log(error);
                     layer.alert("服务器异常，请求出错");
                 }

                });
              //window.location.reload(true);
                  //layer.alert("解散成功");
                  //load(1);
          },
              function () {
                  layer.alert("取消成功");
              }
          );
      });



    //首页
      $("#ulList").on('click','#pageOne',function () {
          load(1);
      });
      //上一页
      $("#ulList").on('click','#pagePre',function () {
          pn = pn -1;
          load(pn);
      });
      //下一页
      $("#ulList").on('click','#pageNext',function () {
          pn = pn +1;
          load(pn);

      });
      //
      $("#ulList").on('click','#pageLast',function () {
          var  page = $("#pageInfo").text();
          var  pages = page.split("/");
          load(pages[1]);
      });


  });

  function load(pn){
      $("#tableStyle").empty();
      $("#ulList").empty();
      //页面加载数据
      $.ajax({
              type:"post",
              url:"${base_path}/display/findTeams"+"?time="+Math.random()+"&page="+pn,
              success:function (result) {
                  if (result.data.teams.length <= 0)
                  {
                      $("#tableStyle").clear;
                      $("#tableStyle").html("还没有球队，请先创建！3秒后自动跳转");
                      setTimeout(function () {
                          window.location.href="${pageContext.request.contextPath}/team/create";
                      },3000)
                  }else {
                      var table = $('#tableStyle');
                      for (var i = 0; i < result.data.teams.length; i++) {
                          var $tr = $("<tr id='first'></tr>");
                          var $td1 = $("<td></td>");
                          var $td2 = $("<td></td>");
                          var $td3 = $("<td></td>");
                          var $td4 = $("<td></td>");
                          var $td5 = $("<td></td>");
                          var $td6 = $("<td ></td>");
                          var $center = $("<center></center>");
                          var  button1 = ("<button href=\"\" role=\"button\" class=\"btn btn-info look \" data-toggle=\"modal\">查看</button>");
                          var  button2 = ("<button type=\"button\" style='margin: 0 10px '  class=\"btn btn-default btn-warning btn-sm update\">修改</button>");
                          var  button3 = ("<button type=\"button\"  class=\"btn btn-default btn-danger btn-sm fire\">解散</button>");

                          $center.append(button1);
                          $center.append(button2);
                          $center.append(button3);
                          $td6.append($center);
                          $td1.append(result.data.teams[i].idTeam);
                          $td2.append(result.data.teams[i].name);

                          if (result.data.coachList[i] != null){
                          $td3.append(result.data.coachList[i]);}
                          else {
                              $td3.append("未添加教练");
                              $td3.css("color","red");
                          }
                          if (result.data.teamSize[i] != 0){
                          $td4.append(result.data.teamSize[i]);}
                          else {
                              $td4.append("未添加球员");
                              $td4.css("color","red");
                          }
                          if (result.data.teams[i].status ==0){
                          $td5.append("在役");
                          }
                          $tr.append($td1);
                          $tr.append($td2);
                          $tr.append($td3);
                          $tr.append($td4);
                          $tr.append($td5);
                          $tr.append($td6);
                          table.append($tr);
                      }

                  var  $ulList =   $("#ulList");

                  var  $li1 = $("<li></li>");
                  var  $a1 = $("<a id='pageInfo'></a>");
                  $a1.append( result.data.pageInfo.pageNum +'/'+ (result.data.pageInfo.pages));
                  $li1.append($a1);

                  var  $li2 = $("<li></li>");
                  var  $a2 = $('<a id="pageOne" ></a>');
                  $a2.append( "首页");
                  $li2.append($a2);

                  var  $li3 = $("<li></li>");
                  var  $a3 = $('<a id="pagePre"><上一页</a>');
                   $li3.append($a3);

                   var  $li4 = $("<li></li>");
                   var  $a4 = $('<a id="pageNext">下一页></a>');
                   $li4.append($a4);

                   var  $li5 = $("<li></li>");
                   var  $a5 = $('<a id="pageLast"></a>');
                   $a5.append( "尾页");
                   $li5.append($a5);

                  $ulList.append($li1);
                  $ulList.append($li2);
                  $ulList.append($li3);
                  $ulList.append($li4);
                  $ulList.append($li5);
                  }

              },
              error:function (error) {
                  //错误页面
                  console.log(error);
              }
      });

  };



</script>




</html>
