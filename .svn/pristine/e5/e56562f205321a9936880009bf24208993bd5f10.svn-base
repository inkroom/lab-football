<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<!DOCTYPE html>
<html lang="en">
<c:set var="base_path" value="${pageContext.request.contextPath}"/>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>球队管理</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!--为了让 Bootstrap 开发的网站对移动设备友好，确保适当的绘制和触屏缩放，需要在网页的 head 之中添加 viewport meta 标签，-->
  <%--<link href="${base_path}/resources/css/team/bootstrap.min.css" rel="stylesheet">--%>
  <!-- 新 Bootstrap 核心 CSS 文件 -->
  <%--<link rel="stylesheet" type="text/css" href="${base_path}/resources/css/style.1.0.css" />--%>
  <!--为了让 Bootstrap 开发的网站对移动设备友好，确保适当的绘制和触屏缩放，需要在网页的 head 之中添加 viewport meta 标签，-->
  <link href="${base_path}/resources/css/team/bootstrap.min.css" rel="stylesheet">
  <link href="${base_path}/resources/lib/layer/theme/default/layer.css" rel="stylesheet">
  <!-- 新 Bootstrap 核心 CSS 文件 -->
  <link rel="stylesheet" type="text/css" href="${base_path}/resources/css/team/style.1.0.css" />
  <%--[if IE 8]--%>
  <script src="${base_path}/resources/js/match/html5shiv.min.js"></script>
  <%--[endif]--%>
  <style>
    .list li {
      width: 150px;
      list-style: none;
      float: left;
      line-height: 60px;
      text-align: center;
      padding: 1px 0 0 0;
      box-sizing: border-box;
    }

    .list li:hover {
      border-left: #e2374d 2px solid;
      color: #fff;
      background-color: #3e3e59;
      text-align: center;
      transform: skew(-30deg);
      -webkit-transform: skew(-30deg);
      -moz-transform: skew(-30deg);
      -o-transform: skew(-30deg);
      -ms-transform: skew(-30deg);
    }

    .list li a {
      color: #999;
    }
    .list li a:hover {
      font-size: 16px;
      color: #fff;
      text-decoration: none;
    }
  </style>

</head>

<body>
<nav class="nav-bg" id="auto-width" style="margin:0 auto;">
  <div style="width:1170px;height:60px;margin:0 auto;">
    <div id="nav-logo" style="width:390px;float:left;padding:1px 0 0 0;">
      <img src="${base_path}/resources/img/team/logo足球项目组.png" style="height:60px;width:60px;" />
      <span style="font-size:18px;color:#fff;">四川省青少年校园足球信息网</span>
    </div>
    <div style="float:left;width:780px;margin-left:-10px;">
      <ul class="list">
        <li><a href="#">赛事赛程</a></li>
        <li><a href="#">教练管理</a></li>
        <li><a href="#">球员管理</a></li>
        <li><a href="#">球队管理</a></li>
        <li><a href="#">个人中心</a></li>
      </ul>
    </div>
  </div>
</nav>
<div class="container" style="width:1002px;">
  <ul class="breadcrumb">
    <li><a href="${pageContext.request.contextPath}/display/index">球队预览</a><span class="divider">/</span></li>
    <li class="active">球队创建</li>
  </ul>
  <!--导航结束-->
  <div class="row">
    <div class="span6">
      <table class="table table-bordered table-hover messageCard">
        <tr class="success">
          <td>球队基本信息</td>
        </tr>
        <tr>
          <td>
            <p><span class="muted">队&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名:</span>
              <input id="teamName" type="text" style="height:20px;width:190px;">
              <span id="teamName_alert" style="color: red;visibility: hidden">请输入球队的名字</span>
              <%-- <span id="teamName_duplication" style="color: red;visibility: hidden">球队名已存在，如果是要继续添加球员，那么请忽视，否则请重新赋球队名！</span>--%>
            </p>
            <p><span class="muted">球队类型:</span>
              <select id="teamClazz" style="width:204px;" name="type">
                <option value="1">小学一年级</option>
                <option value="2">小学二年级</option>
                <option value="3">小学三年级</option>
                <option value="4">小学四年级</option>
                <option value="5">小学五年级</option>
                <option value="6">小学六年级</option>
                <option value="7">初中一年级</option>
                <option value="8">小学二年级</option>
                <option value="9">小学三年级</option>
                <option value="10">混合(年级)</option>
                <option value="11">混合(校级)</option>
              </select>
            </p>
            <p><span class="muted">球队状态:</span>
              <input type="radio" name="teamStatus" checked="checked" value="0"> 在役
              <input type="radio" name="teamStatus" value="1"> 退役
            </p>
          </td>
        </tr>
      </table>
    </div>
    <div class="span6">
      <table class="table table-bordered table-hover messageCard" style="margin-left:60px;">
        <tr class="success">
          <td>教练信息</td>
        </tr>
        <tr>
          <td>
            <p style="margin-top:6px;">
                <span class="muted">姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名:
                    <span id="coach_name"></span>
                </span>
              <span id="teamCoachName_alert" style="color: red;visibility: hidden">请先点击添加教练按钮</span>
            </p>
            <p style="margin-top:32px;"><span class="muted">教练编号:<span id="coach_id" class="muted"></span></span></p>
            <hr style="margin:0 0 9px 0;">
            <a id="add_coach" href="#myModal1" role="button" class="btn btn-info" data-toggle="modal">添加教练</a>
            <!-- <button type="button" class="btn btn-default btn-info ">添加教练</button> -->
          </td>
        </tr>
      </table>
    </div>
    <div class="pull-right" style="width:98%;">
      <table class="table table-bordered table-hover messageCard" >
        <tr class="success">
          <td>球员信息</td>
        </tr>
        <tr>
          <td>
            <div id="chooesPlayerInfos">

            </div>
            <span id="chooesPlayerInfos_alert" style="color: red;visibility: hidden">请先点击添加球员按钮</span>

            <hr style="clear:both;margin-left:38px;">
            <%--<a role="button" href="#myModal2" class="btn btn-info" data-toggle="modal" style="margin-left:38px;">添加球员</a>--%>
            <%--<button id="getAllPlayers" type="button" class="btn btn-default btn-info" style="margin-left:38px;">添加球员</button>--%>
            <a id="getAllPlayers" href="#myModal2" role="button" class="btn btn-info" data-toggle="modal">添加球员</a>
          </td>
        </tr>
      </table>

      <center>
        <button type="button" class="btn btn-default btn-info " id="button_team">提交</button>
        <button type="button" id="back_team" class="btn btn-default ">取消</button>
      </center>
    </div>
  </div>



</div>
<!-- first Modal -->
<div id="myModal1" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel">添加教练</h3>
  </div>
  <div class="modal-body"><!--模态中部开始-->
    <div class="row">
      <div class="span2">
        <div class="input-group">
          <input id="coachName" name="coachName" type="text" class="form-control" style="width:142px;border-radius: 5px;" placeholder="请输入教练姓名">
          <span id="coachName_alert" style="color: red;visibility: hidden">请输入教练的名字</span>
        </div>
        <!-- /input-group -->
      </div>
      <div class="span2">
									<span class="input-group-btn">
																<button id="button_coach" class="btn btn-default" type="button" style="border-radius: 5px;">搜索</button>
														</span>
        <!-- /input-group -->
      </div>
      <!-- /.col-lg-6 -->
    </div>

    <table   class="table table-striped table-hover" style="margin-top:15px;">
      <%--<tr class="info">
        <th>姓名</th>
        <th>编号</th>
        <th>性别</th>
        <th style="padding-left:28px;">操作</th>
      </tr>--%>
      <p style="font-size: 15px;font-weight: 800;"><span style="margin-left: 10px;">姓名</span><span style="margin-left: 128px;">性别</span><span style="margin-left: 69px;">编号</span><span style="margin-left: 130px;">操作</span></p>

      <table id="coach_table" class="table table-striped table-hover" style="margin-top:15px;"></table>
      <tr style="padding-top:5px;">

        <td><span class="hidden-xs coachInfo_name"></span></td>
        <td><span id="coachInfoIdCoach" class="hidden-xs coachInfo_idCoach"></span></td>
        <td><span class="hidden-xs coachInfo_sex"></span></td>

      </tr>
    </table>
  </div><!--模态中部结束-->
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
    <button id="sure_coach" class="btn btn-primary" data-dismiss="modal" aria-hidden="true">确定</button>
  </div>
</div>
<!-- first model end -->
<!-- 模态框2Modal -->
<div id="myModal2" class="modal hide fade"style="width:1002px;margin-left:-500px;" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel">添加球员</h3>
  </div>
  <div class="modal-body"><!--模态框中部开始-->
    <div class="row">
      <div class="span2">
        <div class="input-group">
          <select id="selectGrade" class="form-control" style="width:142px;border-radius: 5px;">
            <option value="1">小学一年级</option>
            <option value="2">小学二年级</option>
            <option value="3">小学三年级</option>
            <option value="4">小学四年级</option>
            <option value="5">小学五年级</option>
            <option value="6">小学六年级</option>
            <option value="7">初中一年级</option>
            <option value="8">初中二年级</option>
            <option value="9">初中三年级</option>
          </select>
        </div>
        <!-- /input-group -->
      </div>
      <div class="span2">
        <div class="input-group">
          <!--<input type="text" placeholder="Text input">-->
          <input id="playerClazz" type="text" class="form-control" style="width:142px;border-radius: 5px;" placeholder="请输入球员班级">
        </div>
        <!-- /input-group -->
      </div>
      <div class="span2">
        <div class="input-group">
          <input id="playerName" type="text" class="form-control" style="width:142px;border-radius: 5px;" placeholder="请输入球员姓名">
        </div>
        <!-- /input-group -->
      </div>
      <div class="span2">
        <span class="input-group-btn">
          <button id="player_btn" class="btn btn-default" type="button" style="border-radius: 5px;">搜索</button>
        </span>
        <!-- /input-group -->
      </div>
      <div class="span2">
        <div class="input-group">
          <%--  <input id="playerId" type="text" class="form-control" style="width:142px;border-radius: 5px;" placeholder="请输入球员ID">
            <span id="playerId_alert" style="color: red;visibility: hidden">请输入球员的ID</span>--%>
        </div>
        <!-- /input-group -->
      </div>
      <div class="span2">
										<span class="input-group-btn">
                                          <%--<button id="playerName_btn" class="btn btn-default" type="button" style="border-radius: 5px;">搜索</button>--%>
                                        </span>
        <!-- /input-group -->
      </div>
      <!-- /.col-lg-6 -->
    </div>

    <table class="table table-striped table-hover" style="margin-top:15px;text-align: center;">
      <%--<tr class="info">
        <th>姓名</th>
        <th>编号</th>
        <th>性别</th>
        <th>身份证号</th>
        <th><input type="checkbox" id="all" style="margin-bottom:-2px;">&nbsp;全选</th>
      </tr>--%>
      <p style="font-size: 15px;font-weight: 800;"><span style="margin-left: 8px;">姓名</span><span style="margin-left: 139px;">编号</span><span style="margin-left: 127px;">性别</span><span style="margin-left: 55px;">班级</span><span style="margin-left: 90px;">身份证</span><span style="margin-left: 295px;"><input type="checkbox" id="all"  />&nbsp;全选</span></p>

      <table id="player_table" class="table table-striped table-hover" style="margin-top:15px;text-align: center;">
      </table>

    </table>
  </div><!--模态框中部结束-->
  <div class="modal-footer pagination">
    <center>
      <ul id="ulList">
      </ul>
      <button onclick="add()"  class="btn btn-primary pull-right" data-dismiss="modal" aria-hidden="true">确定</button>
      <button class="btn pull-right"style="margin-right: 10px;" data-dismiss="modal" aria-hidden="true">关闭</button>

    </center>


    <%--id="addPlayer_btn"--%>
  </div>
</div>
<input type="hidden" value="${token}" id="token">
<!-- 模态框2Modal结束 -->
<!--container end-->
<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
<script src="${base_path}/resources/lib/jquery/jquery-3.1.1.min.js "></script>
<script src="${base_path}/resources/lib/jquery/jquery-1.11.3.js "></script>
<script src="${base_path}/resources/lib/layer/layer.js "></script>
<!-- <script src="js/jquery-3.1.1.min.js"></script> -->
<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="${base_path}/resources/lib/bootstrap.min.js"></script>
<script src="${path}/resources/js/index.js"></script>
<!-- 提交按钮触发 -->



<script>
    $(function(){
        //选择年级的时候就显示球员
        var  pg = 1;
        $("#getAllPlayers").click(function () {
            /*$("#playerClazz").val("");
            $("#playerName").val("");*/
            laodIfPlayer(1);
        });

        $("#selectGrade").change(function () {
            $("#playerClazz").val("");
            $("#playerName").val("");
            laodIfPlayer(1);
        });
        //首页
        $("#ulList").on('click','#ifpageOne',function () {
            laodIfPlayer(pg);
        });
        //上一页
        $("#ulList").on('click','#ifpagePre',function () {
            pg = pg -1;
            laodIfPlayer(pg);
        });
        //下一页
        $("#ulList").on('click','#ifpageNext',function () {
            pg = pg +1;
            laodIfPlayer(pg);

        });
        //
        $("#ulList").on('click','#ifpageLast',function () {
            var  page = $("#ifpageInfo").text();
            var  pages = page.split("/");
            laodIfPlayer(pages[1]);
        });


        function laodIfPlayer(pg) {
            $("#ulList").text("");
            var token = $('#token').val();
            var selectGrade = $("#selectGrade").val();//年级信息
            ajax({
                type: "POST",
                url: "${base_path}/coach/findPlayersByconditions",
                dataType: "json",
                data: {"grade": selectGrade,"token": token,"page":pg},
                success: function (result) {
                    if(result.status==1){
                        $("#player_table").html("");
                        $("#playerId").val("");
                    }else {
                        var  $ulList =   $("#ulList");

                        var  $li1 = $("<li></li>");
                        var  $a1 = $("<a id='ifpageInfo'></a>");
                        $a1.append( result.data.pageInfo.pageNum +'/'+ (result.data.pageInfo.pages));
                        $li1.append($a1);

                        var  $li2 = $("<li></li>");
                        var  $a2 = $('<a id="ifpageOne" ></a>');
                        $a2.append( "首页");
                        $li2.append($a2);

                        var  $li3 = $("<li></li>");
                        var  $a3 = $('<a id="ifpagePre"><上一页</a>');
                        $li3.append($a3);

                        var  $li4 = $("<li></li>");
                        var  $a4 = $('<a id="ifpageNext">下一页></a>');
                        $li4.append($a4);

                        var  $li5 = $("<li></li>");
                        var  $a5 = $('<a id="ifpageLast"></a>');
                        $a5.append( "尾页");
                        $li5.append($a5);

                        $ulList.append($li1);
                        $ulList.append($li2);
                        $ulList.append($li3);
                        $ulList.append($li4);
                        $ulList.append($li5);
                        var players = result.data.players;
                        $("#player_table").html("");
                        $("#playerId").val("");

                        jQuery.each(result.data.players, function(i,item){
                            var player_sex = item.sex;
                            if (player_sex==0){
                                player_sex='男';
                            }else{
                                player_sex='女';
                            }
                            $("#player_table").append("<tr>" +
                                "<td>"+item.name+"</td>" +
                                "<td>"+item.idPlayer+"</td>" +
                                "<td>"+player_sex+"</td>" +
                                "<td>"+item.classes+"</td>" +
                                "<td>"+item.idCard+"</td>" +
                                "<td><input id='select_playerid' name='select_player' type='checkbox' value='"+item.idPlayer+"'/></td>" +
                                "</tr>");
                        });
                    }

                }

            })
        }


        //点击添加球员的时候，显示所有的球员

        /* var token = $('#token').val();
         var selectGrade = $("#selectGrade").val();//年级信息
         var playerClazz = $("#playerClazz").val();//班级
         var playerName = $("#playerName").val();//球员姓名

         ajax({
             type: "POST",
             url: "${base_path}/coach/findPlayersByconditions",
                dataType: "json",
                data: {"grade": selectGrade,"classes":playerClazz,"name":playerName,token: token},
                success: function (result) {

                    $("#player_table").html("");
                    $("#playerId").val("");

                    jQuery.each(result.data.players, function(i,item){

                        $("#player_table").append("<tr>" +
                            "<td>"+item.name+"</td>" +
                            "<td>"+item.idPlayer+"</td>" +
                            "<td>"+item.sex+"</td>" +
                            "<td>"+item.classes+"</td>" +
                            "<td>"+item.idCard+"</td>" +
                            "<td><input id='select_playerid' name='select_player' type='checkbox' value='"+item.idPlayer+"'/></td>" +
                            "</tr>");
                    });
                }

            })*/

        //返回主页
        $("#back_team").click(function () {
            window.location.href="${base_path}/display/index"
        })


        //队名这里，失去焦点，判断该队名是否已经存在
        $("#teamName").blur(function(){
            var teamName = $("#teamName").val();//获得球队名称
            var veryfiy=true;//判断位
            if(teamName.length == 0){
                veryfiy=false;
                $("#teamName_alert").css("visibility","visible");
                veryfiy=false;
            }else {
                $("#teamName_alert").css("visibility","hidden");
            }
            if (veryfiy){
                $.ajax({
                    type: "POST",
                    url: "${base_path}/teamInfo/findTeamName",
                    dataType: "json",
                    data: {"teamName": teamName},
                    success: function (data) {
                        if (data != null){
                            //说明队名存在，应该提示他
                            $("#teamName_duplication").css("visibility","visible");
                        }else{
                            //说明队名不存在，可以使用
                            $("#teamName_duplication").css("visibility","hidden");
                        }
                    }
                })
            }
        })

        $("#add_coach").click(function () {
            var token = $('#token').val();
            ajax({
                type: "POST",
                url: "${base_path}/coach/findAllCoaches",
                dataType: "json",
                data: {token: token},
                success: function (result) {
                    if (result.status == 0) {
//                    $("#coach_table").val("");
                        $("#coach_table").html("");
                        jQuery.each(result.data.coachInfos, function (i, item) {
                            var coach_sex = item.sex;
                            if (coach_sex == 0) {
                                coach_sex = '男';
                            } else {
                                coach_sex = '女';
                            }
                            $("#coach_table").append("<tr>" +
                                "<td>" + item.coachName + "</td>" +
                                "<td>" + coach_sex + "</td>" +
                                "<td>" + item.idCoach + "</td>" +
                                "<td><input id='select_coachid' name='select_coach' type='radio' value='" + item.idCoach + "'/></td>" +
                                "</tr>");
                        });
                    }
                }

            })
        });

        $("#playerName_btn").click(function () {
            var token = $('#token').val();
            var playerId = $("#playerId").val();//球员ID
            var veryfiy=true;
            if(playerId.length == 0){
                veryfiy=false;
                $("#playerId_alert").css("visibility","visible");
                veryfiy=false;
            }else {
                $("#playerId_alert").css("visibility","hidden");
            }
            if (veryfiy){
                ajax({
                    type: "POST",
                    url: "${base_path}/coach/findPlayerByPlayerId",
                    dataType: "json",
                    data: {"idPlayer": playerId,token: token},
                    success: function (result) {
                        if (result.status == 0){
                            $("#player_table").html("");
//                        alert(data);
                            var player_sex = result.data.player.sex;
                            if (player_sex==0){
                                player_sex='男';
                            }else{
                                player_sex='女';
                            }
//                        当通过ID来搜索球员的时候
                            if(player_sex!=""){
                                $("#selectGrade").val("");//设置年级信息为空
                                $("#playerClazz").val("");//设置班级为空
                                $("#playerName").val("");//设置球员姓名为空
                            }
                            $("#player_table").append("<tr>" +
                                "<td>"+result.data.player.name+"</td>" +
                                "<td>"+result.data.player.idPlayer+"</td>" +
                                "<td>"+player_sex+"</td>" +
                                "<td>"+result.data.player.classes+"</td>" +
                                "<td>"+result.data.player.idCard+"</td>" +
                                "<td><input id='select_playerid' name='select_player' type='checkbox' value='"+result.data.player.idPlayer+"'/></td>" +
                                "</tr>");
                        }

                    }

                })
            }

        });
        var  pn = 1;
        $("#player_btn").click(function () {
            //$("#ulList").text("");
            laoda(pn)
        });
        $("#ulList").on('click','#pageOne',function () {
            laoda(pn);
        });
        //上一页
        $("#ulList").on('click','#pagePre',function () {
            pn = pn -1;
            laoda(pn);
        });
        //下一页
        $("#ulList").on('click','#pageNext',function () {
            pn = pn +1;
            laoda(pn);

        });
        //
        $("#ulList").on('click','#pageLast',function () {
            var  page = $("#pageInfo").text();
            var  pages = page.split("/");
            laoda(pages[1]);
        });

        function laoda(pn){
            $("#ulList").empty();
            var token = $('#token').val();
            var selectGrade = $("#selectGrade").val();//年级信息
            var playerClazz = $("#playerClazz").val();//班级
            var playerName = $("#playerName").val();//球员姓名
            ajax({
                type: "POST",
                url: "${base_path}/coach/findPlayersByconditions",
                dataType: "json",
                data: {"grade": selectGrade,"classes":playerClazz,"name":playerName,token: token,"page":pn},
                success: function (result) {
                    if (result.status ==0) {
                        $("#player_table").html("");
                        $("#playerId").val("");
                        var $ulList = $("#ulList");

                        var $li1 = $("<li></li>");
                        var $a1 = $("<a id='pageInfo'></a>");
                        $a1.append(result.data.pageInfo.pageNum + '/' + (result.data.pageInfo.pages));
                        $li1.append($a1);

                        var $li2 = $("<li></li>");
                        var $a2 = $('<a id="pageOne" ></a>');
                        $a2.append("首页");
                        $li2.append($a2);

                        var $li3 = $("<li></li>");
                        var $a3 = $('<a id="pagePre"><上一页</a>');
                        $li3.append($a3);

                        var $li4 = $("<li></li>");
                        var $a4 = $('<a id="pageNext">下一页></a>');
                        $li4.append($a4);

                        var $li5 = $("<li></li>");
                        var $a5 = $('<a id="pageLast"></a>');
                        $a5.append("尾页");
                        $li5.append($a5);

                        $ulList.append($li1);
                        $ulList.append($li2);
                        $ulList.append($li3);
                        $ulList.append($li4);
                        $ulList.append($li5);
                        jQuery.each(result.data.players, function (i, item) {
                            var player_sex = item.sex;
                            if (player_sex == 0) {
                                player_sex = '男';
                            } else {
                                player_sex = '女';
                            }
                            $("#player_table").append("<tr>" +
                                "<td>" + item.name + "</td>" +
                                "<td>" + item.idPlayer + "</td>" +
                                "<td>" + player_sex + "</td>" +
                                "<td>" + item.classes + "</td>" +
                                "<td>" + item.idCard + "</td>" +
                                "<td><input id='select_playerid' name='select_player' type='checkbox' value='" + item.idPlayer + "'/></td>" +
                                "</tr>");
                        });
                    }
                }

            })
        }

        $("#sure_coach").click(function () {
            var token = $('#token').val();
            var select_coachId=$('input:radio[name="select_coach"]:checked').val();
            var coachInfo_idCoach = select_coachId;
            if (coachInfo_idCoach == null){
                layer.msg("你未选择教练");
            }else {
                ajax({
                    type: "POST",
                    url: "${base_path}/coach/findCoachById",
                    dataType: "json",
                    data: {"idCoach": coachInfo_idCoach,token: token},
                    success: function (result) {
                        if (result.status == 0) {
                            $("#coach_name").html(result.data.coachInfo.coachName);
                            $("#coach_id").html(result.data.coachInfo.idCoach);
                        }
                    }
                })
            }
        })


        $("#button_coach").click(function () {
            var token = $('#token').val();
            //获得输入的数据
            var coachName  = $("#coachName").val();
            var veryfiy=true;
            if(coachName.length==0){
                $("#coachName_alert").css("visibility","visible");
                veryfiy=false;
            }else {
                $("#coachName_alert").css("visibility","hidden");
            }
            if(veryfiy){
                ajax({
                    type:"POST",
                    url:"${base_path}/coach/findCoachByName",
                    dataType:"json",
                    data:{"coachName":coachName,token: token},
                    success:function (result) {
                        if (result.status == 0) {
                            $("#coach_table").html("");
                            jQuery.each(result.data.coachInfos, function (i, item) {
                                var coach_sex = item.sex;
                                if (coach_sex == 0) {
                                    coach_sex = '男';
                                } else {
                                    coach_sex = '女';
                                }
                                $("#coach_table").append("<tr>" +
                                    "<td>" + item.coachName + "</td>" +
                                    "<td>" + coach_sex + "</td>" +
                                    "<td>" + item.idCoach + "</td>" +
                                    "<td><input id='select_coachid' name='select_coach' type='radio' value='" + item.idCoach + "'/></td>" +
                                    "</tr>");
                            });
                        }
                    }
                });
            }
            $("#coachName").val("");
        });

        $("#button_team").click(function () {
            var token = $('#token').val();

            //获得所有关于球队的信息，队名，教练，球员等...
            var teamName = $("#teamName").val();//获取队名
            var teamClazz = $("#teamClazz").val();//获取班级
            var teamStatus = $('input:radio[name="teamStatus"]:checked').val();//球队状态
            var teamCoachName = $("#coach_name").html();//教练的名字
            var teamCoachId = $("#coach_id").html();//教练的ID
            var teamPlayerInfos = $("#chooesPlayerInfos").html();//球员信息
//            alert(teamPlayerInfos.length);
            //判断输入框内是否为空
            var veryfiy=true;
            if(teamName.length==0){
                $("#teamName_alert").css("visibility","visible");
                veryfiy=false;
            }else {
                $("#teamName_alert").css("visibility","hidden");
            }

            if(teamCoachName.length==0){
                $("#teamCoachName_alert").css("visibility","visible");
                veryfiy=false;
            }else {
                $("#teamCoachName_alert").css("visibility","hidden");
            }

            if(teamPlayerInfos.length==0){
                $("#chooesPlayerInfos_alert").css("visibility","visible");
                veryfiy=false;
            }else {
                $("#chooesPlayerInfos_alert").css("visibility","hidden");
            }
//            $("#playerId").val();
            if(veryfiy){
                ajax({
                    type:"POST",
                    url:"${base_path}/teamInfo/addTeamInfo",
                    dataType:"json",
//                contentType:"application/json",
                    data:{"teamName":teamName,"teamClazz":teamClazz,"teamStatus":teamStatus,"teamCoachId":teamCoachId,token: token},
                    success:function (result) {
                        switch (result.status) {
                            case 0:
                                msg('添加成功！');
                                window.location.href="${base_path}/display/index"
                                break;
                            case 1:
                                msg('添加失败，请重试');
                                break;
                        }
                    }
                });
            }

        });

    });
</script>
<%--<script>
    $(function(){
        $("#all").change(function(){
            var flage =$(this).is(":checked");
            $("input[type=checkbox]").each(function(){
                $(this).prop("checked",flage);
            })
        })
    })
</script>--%>
<script type="text/javascript">
    window.onload = function () {
        var all = document.getElementById("all");
        all.onclick = function () {
            var product = document.getElementsByName("select_player");
            var ll= product.length;
            for(var i=ll;i--;){
                product[i].checked = all.checked;
            }
            for(var i=ll;i--;){
                product[i].onclick = function(){
                    var k = 0;
                    for(var i=ll;i--;)product[i].checked && k++;
                    all.checked = ll==k;
                };
            }
        }

    }

</script>
<script>
    function add() {
        var token = $('#token').val();
        var flag = window.checkFlash;
        console.log(typeof(flag));
        var arr = [];
        $("input[type='checkbox']:checked").each(function () {
            arr.push($(this).val());
            typeof (toString(arr));
        });

        ajax({
            type: "POST",
            url: "${base_path}/coach/getAllPlayersByIds",
            dataType: "json",
            data: {"playerids": JSON.stringify(arr),"flag":flag,token: token},

            success: function (result) {
                <fmt:bundle basename="properties.upload">
                if (result.status == 0) {
                    jQuery.each(result.data.players, function (i, item) {
                        $("#chooesPlayerInfos").append(
                            " <div id=\"playerInfos\" class=\"zhazhazha\">" +
                            "<img class=\"clo\" src=\"${base_path}/<fmt:message key="upload.image.url.prefix"/>/"+item.headPic+"\" style=\"width:100%;\"/>" +
                            "<a onclick=\"deleteRow($(this)," + item.idPlayer + ");\">" +
                            "<span class=\"glyphicon glyphicon-remove\">x</span>" +
                            "</a>\n" +
                            "<p class=\"muted zhazhahui\">" +
                            "<span>" + item.name + "</span><br><span>" + item.idPlayer + "</span>" +
                            "</p>" +
                            "</div>");
                    })
                    window.checkFlash = 0;
                }
                </fmt:bundle>
            }
        })

    }
</script>
<script>
    //删除指定的球员的信息
    function deleteRow(obj,id){
        var token = $('#token').val();
        var playerid = id;
        if (playerid != null){
            ajax({
                type: "POST",
                url: "${base_path}/coach/deletePlayerById",
                dataType:"json",
                data: {"playerid": playerid,"token": token},
                success:function (result) {
                    if (result.status == 0){
                        obj.parent().remove();
                    }
                }
            });
        }

    }

</script>
<script>
    //判断页面是否刷新
    if(window.checkFlash){
        window.checkFlash = 0;
    }else{
        window.checkFlash = 1;
    }
</script>

</body>

</html>
