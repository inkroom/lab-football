<!DOCTYPE html>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<c:set var="base_path" value="${pageContext.request.contextPath}"></c:set>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>球队管理</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!--为了让 Bootstrap 开发的网站对移动设备友好，确保适当的绘制和触屏缩放，需要在网页的 head 之中添加 viewport meta 标签，-->
  <link href="${base_path}/resources/css/team/bootstrap.min.css" rel="stylesheet">
  <link href="${base_path}/resources/lib/layer/theme/default/layer.css" rel="stylesheet">
  <!-- 新 Bootstrap 核心 CSS 文件 -->
  <link rel="stylesheet" type="text/css" href="${base_path}/resources/css/common/style.css" />
  <link rel="stylesheet" type="text/css" href="${base_path}/resources/css/team/createTeam-style.css" />

  <link rel="stylesheet" type="text/css" href="${base_path}/resources/css/team/bootstarp3-btn.css"/>

  <!--[if IE 8]>
    <script src="${base_path}/resources/js/team/html5shiv.min.js"></script>
    <script src="${base_path}/resources/js/team/placeholder.min.js" charset="utf-8"></script>
  <![endif]-->
  <style>
    body{
      font-size:16px;
      font-family: "Microsoft YaHei UI";
    }
    .list li {
      width: 150px;
      list-style: none;
      float: left;
      line-height: 60px;
      text-align: center;
      padding: 1px 0 0 0;
      box-sizing: border-box;
    }

    .list li:hover {
      border-left: #e2374d 2px solid;
      color: #fff;
      background-color: #3e3e59;
      text-align: center;
      transform: skew(-30deg);
      -webkit-transform: skew(-30deg);
      -moz-transform: skew(-30deg);
      -o-transform: skew(-30deg);
      -ms-transform: skew(-30deg);
    }

    .list li a {
      color: #999;
    }

    .list li a:hover {
      font-size: 16px;
      color: #fff;
      text-decoration: none;
    }
  </style>
</head>

<body>
<jsp:include page="../common/head.jsp?v=23"/>
<div class="container" style="width:1002px;">
  <%--<ul class="breadcrumb">
    <li><a href="${pageContext.request.contextPath}/display/index">球队预览</a><span class="divider">/</span></li>
    <li class="active">球队修改</li>
  </ul>--%>
  <ul class="nav nav-tabs" style="margin-top:50px;">
    <li><a href="${pageContext.request.contextPath}/team/index">球队预览</a></li>
    <li class="active"><a>球队修改</a></li>
  </ul>
  <!--导航结束-->
  <div class="row">
    <div class="span6">
      <table class="table table-bordered table-hover messageCard">
        <tr class="success">
          <td>球队基本信息</td>
        </tr>
        <tr>
          <td>
            <p><span class="muted">队&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名:</span>
              <input id="teamName" type="text"style="color:black"></p>
            <p><span class="muted">球队类型:</span>
              <select id="teamClazz" name="type"style="color:black">
                <option value="1">小学一年级</option>
                <option value="2">小学二年级</option>
                <option value="3">小学三年级</option>
                <option value="4">小学四年级</option>
                <option value="5">小学五年级</option>
                <option value="6">小学六年级</option>
                <option value="7">初中一年级</option>
                <option value="8">小学二年级</option>
                <option value="9">小学三年级</option>
                <option value="10">混合(年级)</option>
                <option value="11">混合(校级)</option>
              </select></p>
            <p><span class="muted">球队状态:</span>
              <span style="color:black"> 在役</span>
            </p>
          </td>
        </tr>
      </table>
    </div>
    <div class="span6">
      <table class="table table-bordered table-hover messageCard" style="margin-left:60px;">
        <tr class="success">
          <td>教练信息</td>
        </tr>
        <tr>
          <td>
            <div style="width:50%;float:left;">
              <p style="margin-top:6px;">
                <span class="muted" >姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名: <span id="coach_name" style="color:black"></span></span>
              </p>
              <p style="margin-top:20px;">
                <span class="muted" >年&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;龄: <span id="coachAge"style="color:black"></span></span>
              </p>

            </div>
            <div style="width:50%;float:right;">
              <p style="margin-top:6px;">
                <span class="muted" >性&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;别: <span id="coachSex"style="color:black"></span></span>
              </p>
              <p style="margin-top:20px;"><span class="muted" >教练编号: <span id="coach_id"style="color:black"></span></span></p>
            </div>

            <a id="add_coach" href="#myModal1" role="button" class="btn3 btn3-success" data-toggle="modal" style="margin-top: 20px">添加教练</a>
            <!-- <button type="button" class="btn btn-default btn-info ">添加教练</button> -->
          </td>
        </tr>
      </table>
    </div>
    <div class="pull-right" style="width:98%;">
      <table class="table table-bordered table-hover messageCard" >
        <tr class="success">
          <td>球员信息</td>
        </tr>
        <tr>
          <td class="rowPlayer">
            <div id="chooesPlayerInfos">

           </div >
            <hr style="clear:both;margin-left:38px;">
            <a id="getAllPlayers" href="#myModal2" role="button" class="btn3 btn3-success " data-toggle="modal" style="margin-left:38px;">添加球员</a>
            <!-- <button type="button" class="btn btn-default btn-info" style="margin-left:38px;">添加球员</button> -->
          </td>
        </tr>
      </table>

      <center>
        <button type="button" class="btn3 btn3-large btn3-success " id="button_team">提交</button>
        <button type="button" class="btn3 btn3-large btn3-default" id="close">取消</button>
      </center>
    </div>
  </div>



</div>
<!-- first Modal -->
<div id="myModal1" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel">添加教练</h3>
  </div>
  <div class="modal-body"><!--模态中部开始-->
    <div class="row">
      <div class="span3">
        <div class="input-group">
          <input id="coachName" name="coachName" type="text" class="form-control"  placeholder="请输入教练姓名">
          <span id="coachName_alert" style="color: red;visibility: hidden">请输入教练的名字</span>
        </div>
        <!-- /input-group -->
      </div>
      <div class="span3">
									<span class="input-group-btn">
																<button id="button_coach" class="btn " type="button" style="border-radius: 5px;">搜索</button>
														</span>
        <!-- /input-group -->
      </div>
      <!-- /.col-lg-6 -->
    </div>


<%--      <tr class="info" style="text-align: center;">
        <th style="padding-left:0px;">姓名</th>
        <th style="magin-left:58px;">性别</th>
        <th style="padding-left:18px;">编号</th>
        <th style="padding-left:28px;">操作</th>
      </tr>--%>
<%--
      <p style="font-size: 15px;font-weight: 800;"><span style="margin-left: 10px;">姓名</span><span style="margin-left: 128px;">性别</span><span style="margin-left: 69px;">编号</span><span style="margin-left: 130px;">操作</span></p>
--%>
      <table class="table table-striped table-hover" style="margin-top:-20px;">
        <tr class="info" style="text-align: center;">
          <th style="padding-left:0px;">姓名</th>
          <th style="magin-left:58px;">性别</th>
          <th style="padding-left:18px;">编号</th>
          <th style="padding-left:28px;">操作</th>
        </tr>
        <tbody id="coach_table"></tbody>
      </table>


     <%--   <td><span class="hidden-xs coachInfo_name"></span></td>
        <td><span id="coachInfoIdCoach" class="hidden-xs coachInfo_idCoach"></span></td>
        <td><span class="hidden-xs coachInfo_sex"></span></td>--%>

  </div><!--模态中部结束-->
  <div class="modal-footer">
    <button class="btn " data-dismiss="modal" aria-hidden="true">关闭</button>
    <button id="sure_coach" class="btn btn-info " style="color:black;" data-dismiss="modal" aria-hidden="true">确定</button>
  </div>
</div>
<!-- first model end -->
<!-- 模态框2Modal -->
<div id="myModal2" class="modal hide fade"style="width:1002px;margin-left:-500px;" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel">添加球员</h3>
  </div>
  <div class="modal-body"><!--模态框中部开始-->
    <div class="row">
      <div class="span3">
        <div class="input-group">
          <select id="selectGrade" class="form-control">
            <option value="1">小学一年级</option>
            <option value="2">小学二年级</option>
            <option value="3">小学三年级</option>
            <option value="4">小学四年级</option>
            <option value="5">小学五年级</option>
            <option value="6">小学六年级</option>
            <option value="7">初中一年级</option>
            <option value="8">初中二年级</option>
            <option value="9">初中三年级</option>
          </select>
        </div>
        <!-- /input-group -->
      </div>
      <div class="span3">
        <div class="input-group">
          <!--<input type="text" placeholder="Text input">-->
          <input id="playerClazz" type="text" class="form-control"  placeholder="请输入球员班级">
        </div>
        <!-- /input-group -->
      </div>
      <div class="span3">
        <div class="input-group">
          <input id="playerName" type="text" class="form-control"  placeholder="请输入球员姓名">
        </div>
        <!-- /input-group -->
      </div>
      <div class="span3">
        <span class="input-group-btn">
          <button id="player_btn" class="btn " type="button">搜索</button>
        </span>
        <!-- /input-group -->
      </div>
      <!-- /.col-lg-6 -->
    </div>

    <table class="table table-striped table-hover" style="margin-top:15px;text-align: center;">
      <%--<tr class="info">
        <th>姓名</th>
        <th>编号</th>
        <th>性别</th>
        <th>班级</th>
        <th>身份证号</th>
        <th><input type="checkbox" id="all" style="margin-bottom:-2px;">&nbsp;全选</th>
      </tr>--%>
      <tr>  </tr>
        <p style="font-size: 15px;font-weight: 800;"><span style="margin-left: 8px;">姓名</span><span style="margin-left: 139px;">编号</span><span style="margin-left: 130px;">性别</span><span style="margin-left: 55px;">班级</span><span style="margin-left: 90px;">身份证</span><span style="margin-left: 300px;"><input type="checkbox" id="all"  />&nbsp;全选</span></p>
        <table id="player_table" class="table table-striped table-hover" style="margin-top:15px;text-align: center;">
      </table>

    </table>
  </div><!--模态框中部结束-->
  <div class="modal-footer pagination">
    <center>
        <ul id="ulList">
        </ul>
      <button onclick="add()"  class="btn btn-info  pull-right" style="color:black;" data-dismiss="modal" aria-hidden="true">确定</button>
      <button class="btn  pull-right"style="margin-right: 10px;" data-dismiss="modal" aria-hidden="true">关闭</button>

    </center>


    <%--id="addPlayer_btn"--%>
  </div>
</div>
<input type="hidden" value="${token}" id="token">
<!-- 模态框2Modal结束 -->
<!--container end-->
<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
<script src="${base_path}/resources/lib/jquery/jquery-3.1.1.min.js "></script>
<script src="${base_path}/resources/lib/jquery/jquery-1.11.3.js "></script>
<script src="${base_path}/resources/lib/layer/layer.js "></script>
<script src="${path}/resources/js/index.js"></script>
<!-- <script src="js/jquery-3.1.1.min.js"></script> -->
<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="${base_path}/resources/js/team/bootstrap.min.js"></script>
<!-- 提交按钮触发 -->
<%--<script src="../../../resources/js/createTeam.js"/>--%>

<script>
    $(function(){
          pg = 1;
        $("#getAllPlayers").click(function () {
            var all = $("#all");
            all.removeAttr("checked");
            $("#playerClazz").val("");
            $("#playerName").val("");
            pg = 1;
            laodIfPlayer(pg);
        });

        $("#selectGrade").change(function () {
            $("#playerClazz").val("");
            $("#playerName").val("");
            pg = 1;
            laodIfPlayer(pg);
        });
        //首页
        $("#ulList").on('click','#ifpageOne',function () {
            pg = 1;
            laodIfPlayer(pg);
        });
        //上一页
        $("#ulList").on('click','#ifpagePre',function () {
            if(pg > 1){
                pg = pg -1;
                laodIfPlayer(pg);
            }else {
                pg = 1;
            }
        });
        //下一页
        $("#ulList").on('click','#ifpageNext',function () {
            var  page = $("#ifpageInfo").text();
            var  pages = page.split("/");
            if (pg <pages[1]){
                pg = pg +1;
                laodIfPlayer(pg);
            }else {
                pg = pages[1];
            }

        });
        //
        $("#ulList").on('click','#ifpageLast',function () {
            var  page = $("#ifpageInfo").text();
            var  pages = page.split("/");
            pg = pages[1];
            laodIfPlayer(pages[1]);
        });


        function laodIfPlayer(pg) {
            $("#ulList").text("");
            var token = $('#token').val();
            var selectGrade = $("#selectGrade").val();//年级信息
            if (selectGrade == null){
                layer.msg("请选择年级");
            }else {
            ajax({
                type: "POST",
                url: "${base_path}/team/findPlayersByconditions",
                dataType: "json",
                data: {"grade": selectGrade,token: token,"page":pg},
                success: function (result) {
                    if(result.status==1){
                        $("#player_table").html("");
                        $("#playerId").val("");
                    }else {
                        var  $ulList =   $("#ulList");

                        var  $li1 = $("<li></li>");
                        var  $a1 = $("<a id='ifpageInfo'></a>");
                        $a1.append( result.data.pageInfo.pageNum +'/'+ (result.data.pageInfo.pages));
                        $li1.append($a1);

                        var  $li2 = $("<li></li>");
                        var  $a2 = $('<a id="ifpageOne" ></a>');
                        $a2.append( "首页");
                        $li2.append($a2);

                        var  $li3 = $("<li></li>");
                        var  $a3 = $('<a id="ifpagePre"><上一页</a>');
                        $li3.append($a3);

                        var  $li4 = $("<li></li>");
                        var  $a4 = $('<a id="ifpageNext">下一页></a>');
                        $li4.append($a4);

                        var  $li5 = $("<li></li>");
                        var  $a5 = $('<a id="ifpageLast"></a>');
                        $a5.append( "尾页");
                        $li5.append($a5);

                        $ulList.append($li1);
                        $ulList.append($li2);
                        $ulList.append($li3);
                        $ulList.append($li4);
                        $ulList.append($li5);
                        var players = result.data.players;
                        $("#player_table").html("");
                        $("#playerId").val("");

                        jQuery.each(result.data.players, function(i,item){
                            var player_sex = item.sex;
                            if (player_sex==0){
                                player_sex='男';
                            }else{
                                player_sex='女';
                            }
                            $("#player_table").append("<tr>" +
                                "<td style='width:150px;'>"+item.name+"</td>" +
                                "<td>"+item.idPlayer+"</td>" +
                                "<td>"+player_sex+"</td>" +
                                "<td>"+item.classes+"</td>" +
                                "<td>"+item.idCard+"</td>" +
                                "<td><input id='select_playerid' name='select_player' type='checkbox' value='"+item.idPlayer+"'/></td>" +
                                "</tr>");
                        });
                    }

                }

            })
         }
        }



        $("#add_coach").click(function () {
            ajax({
                type: "POST",
                url: "${base_path}/team/findAllCoaches",
                dataType: "json",
                data:{"token":$("#token").val()},
                success: function (result) {
                    if (result.status == 0) {
                        $("#coach_table").html("");
                        jQuery.each(result.data.coachInfos, function (i, item) {
                            var coach_sex = item.sex;
                            if (coach_sex == 0) {
                                coach_sex = '女';
                            } else {
                                coach_sex = '男';
                            }
                            $("#coach_table").append("<tr>" +
                                "<td>" + item.coachName + "</td>" +
                                "<td>" + coach_sex + "</td>" +
                                "<td>" + item.idCoach + "</td>" +
                                "<td><input id='select_coachid' name='select_coach' type='radio' value='" + item.idCoach + "'/></td>" +
                                "</tr>");
                        });
                    }
                }

            })
        });

        $("#playerName_btn").click(function () {
            $("#ulList").text("");
            var token = $('#token').val();
            var playerId = $("#playerId").val();//球员ID
            var veryfiy=true;
            if(playerId.length == 0){
                veryfiy=false;
                $("#playerId_alert").css("visibility","visible");
                veryfiy=false;
            }else {
                $("#playerId_alert").css("visibility","hidden");
            }
            if (veryfiy){
                ajax({
                    type: "POST",
                    url: "${base_path}/team/findPlayerByPlayerId",
                    dataType: "json",
                    data: {"idPlayer": playerId,token: token},
                    success: function (result) {
                        if (result.status == 0){
                            $("#player_table").html("");
//                        alert(data);
                            var player_sex = result.data.player.sex;
                            if (player_sex==0){
                                player_sex='男';
                            }else{
                                player_sex='女';
                            }
//                        当通过ID来搜索球员的时候
                            if(player_sex!=""){
                                $("#selectGrade").val("");//设置年级信息为空
                                $("#playerClazz").val("");//设置班级为空
                                $("#playerName").val("");//设置球员姓名为空
                            }
                            $("#player_table").append("<tr>" +
                                "<td>"+result.data.player.name+"</td>" +
                                "<td>"+result.data.player.idPlayer+"</td>" +
                                "<td>"+player_sex+"</td>" +
                                "<td>"+result.data.player.classes+"</td>" +
                                "<td>"+result.data.player.idCard+"</td>" +
                                "<td><input id='select_playerid' name='select_player' type='checkbox' value='"+result.data.player.idPlayer+"'/></td>" +
                                "</tr>");
                        }

                    }

                })
            }

        });

          pn = 1;
        $("#player_btn").click(function () {
            //$("#ulList").text("");
            pn = 1;
            laoda(pn)
        });
        $("#ulList").on('click','#pageOne',function () {
            pn = 1;
            laoda(pn);
        });
        //上一页
        $("#ulList").on('click','#pagePre',function () {
            if(pn > 1){
                pn = pn -1;
                laoda(pn);
            }else {
                pn = 1;
            }
        });
        //下一页
        $("#ulList").on('click','#pageNext',function () {
            var  page = $("#pageInfo").text();
            var  pages = page.split("/");
            if (pn <pages[1]){
                pn = pn +1;
                laoda(pn);
            }else {
                pn = pages[1];
            }

        });
        //
        $("#ulList").on('click','#pageLast',function () {
            var  page = $("#pageInfo").text();
            var  pages = page.split("/");
            pn = pages[1];
            laoda(pages[1]);
        });



         function laoda(pn) {
             $("#ulList").text("");
            var selectGrade = $("#selectGrade").val();//年级信息
            var playerClazz = $("#playerClazz").val();//班级
            var playerName = $("#playerName").val();//球员姓名
            ajax({
                type: "POST",
                url: "${base_path}/team/findPlayersByconditions",
                dataType: "json",
                data: {"grade": selectGrade,"classes":playerClazz,"name":playerName,"page":pn,"token":$("#token").val()},
                success: function (result) {
                    if (result.status == 0) {
                        $("#player_table").html("");
                        $("#playerId").val("");
                        var $ulList = $("#ulList");

                        var $li1 = $("<li></li>");
                        var $a1 = $("<a id='pageInfo'></a>");
                        $a1.append(result.data.pageInfo.pageNum + '/' + (result.data.pageInfo.pages));
                        $li1.append($a1);

                        var $li2 = $("<li></li>");
                        var $a2 = $('<a id="pageOne" ></a>');
                        $a2.append("首页");
                        $li2.append($a2);

                        var $li3 = $("<li></li>");
                        var $a3 = $('<a id="pagePre"><上一页</a>');
                        $li3.append($a3);

                        var $li4 = $("<li></li>");
                        var $a4 = $('<a id="pageNext">下一页></a>');
                        $li4.append($a4);

                        var $li5 = $("<li></li>");
                        var $a5 = $('<a id="pageLast"></a>');
                        $a5.append("尾页");
                        $li5.append($a5);

                        $ulList.append($li1);
                        $ulList.append($li2);
                        $ulList.append($li3);
                        $ulList.append($li4);
                        $ulList.append($li5);
                        jQuery.each(result.data.players, function (i, item) {

                            $("#player_table").append("<tr>" +
                                "<td>" + item.name + "</td>" +
                                "<td>" + item.idPlayer + "</td>" +
                                "<td>" + item.sex + "</td>" +
                                "<td>" + item.classes + "</td>" +
                                "<td>" + item.idCard + "</td>" +
                                "<td><input id='select_playerid' name='select_player' type='checkbox' value='" + item.idPlayer + "'/></td>" +
                                "</tr>");
                        });
                    }
                }

            })
            //var playerClazz = $("#playerClazz").val("");
         }

        $("#sure_coach").click(function () {
            var select_coachId=$('input:radio[name="select_coach"]:checked').val();
            var  coachInfo_idCoach = select_coachId;
            if (coachInfo_idCoach == null){
                layer.msg("你未选择教练");
            }else {
            ajax({
                type: "POST",
                url: "${base_path}/team/findCoachById",
                dataType: "json",
                data: {"idCoach": coachInfo_idCoach,"token":$("#token").val()},
                success: function (result) {
                    if (result.status == 0) {
                        var  sex = "";
                        if (result.data.coachInfo.sex ==0){
                            sex = '女';
                        }else{
                            sex = "男";
                        }
                        $("#coach_name").html(result.data.coachInfo.name);
                        $("#coach_id").html(result.data.coachInfo.idCoach);
                        $("#coachAge").html(result.data.coachInfo.age);
                        $("#coachSex").html(sex);

                    }
                }

               })
            }
        });


        $("#button_coach").click(function () {
            //获得输入的数据
           var coachName  = $("#coachName").val();
            var veryfiy=true;
            if(coachName.length==0){
                $("#coachName_alert").css("visibility","visible");
                veryfiy=false;
            }else {
                $("#coachName_alert").css("visibility","hidden");
            }
            if(veryfiy){
                ajax({
                    type:"POST",
                    url:"${base_path}/team/findCoachByName",
                    dataType:"json",
                    data:{"coachName":coachName,"token":$("#token").val()},
                    success:function (result) {
                        if (result.status == 0) {
                            $("#coach_table").html("");
                            jQuery.each(result.data.coachInfos, function (i, item) {
                                var coach_sex = item.sex;
                                if (coach_sex == 0) {
                                    coach_sex = '男';
                                } else {
                                    coach_sex = '女';
                                }
                                $("#coach_table").append("<tr>" +
                                    "<td>" + item.coachName + "</td>" +
                                    "<td>" + item.idCoach + "</td>" +
                                    "<td>" + coach_sex + "</td>" +
                                    "<td><input id='select_coachid' name='select_coach' type='radio' value='" + item.idCoach + "'/></td>" +
                                    "</tr>");
                            });
                        }
                    }
                });
            }

        });

        $("#button_team").click(function () {
            //获得所有关于球队的信息，队名，教练，球员等...
            layer.confirm('确认提交？',{ btn: ['确定', '取消']},
             function (index) {
             var  idTeam = ${sessionScope.idTeam};
             var  name = $("#teamName").val();
            var  teamTyp = $("#teamClazz").val();
            var  preId = coachids;
            var  newId =$("#coach_id").html();
            var  lenght = $("#chooesPlayerInfos").children().length;
            var  arrPlayer =[];
            for (var i = 0;i<lenght;i++){
                var di  =$("#chooesPlayerInfos").children().eq(i).children().eq(2).children().eq(2).html();
                arrPlayer[i] = di;
           }
            ajax({
                type:"POST",
                url:"${base_path}/team/insert",
                dataType:"json",
                data:{"idTeams":idTeam,"name":name,"types":teamTyp,"preIds":preId,"newIds":newId,"arrPlayer":arrPlayer.toString(),"token":$("#token").val()},
                success:function (result) {
                   if (result.status ==0){
                       layer.alert("修改成功");
                       layer.close(index);
                       $("#chooesPlayerInfos").empty();
                       loadInfo();
                   }else if(result.status ==5)
                    {
                       layer.alert("修改失败，请重试");
                   }

                }
            });

           },
            function () {
                layer.alert("取消成功");
            }

            );

        });



    });
</script>
<%--<script>
    $(function(){
        $("#all").change(function(){
            var flage =$(this).is(":checked");
            $("input[type=checkbox]").each(function(){
                $(this).prop("checked",flage);
            })
        })
    })
</script>--%>
<script type="text/javascript">
  window.onload = function () {
      var all = document.getElementById("all");
      all.onclick = function () {
          var product = document.getElementsByName("select_player");
          var ll= product.length;
              for(var i=ll;i--;){
                  product[i].checked = all.checked;
              }
          for(var i=ll;i--;){
              product[i].onclick = function(){
                  var k = 0;
                  for(var i=ll;i--;)product[i].checked && k++;
                  all.checked = ll==k;
              };
          }
      }

  }

</script>

<script>
    function add() {
        var  aa =[];
        var playerId = $("#chooesPlayerInfos").children().length;
        for(var  i = 0 ;i< playerId ;i++){
            var  id = $("#chooesPlayerInfos").children().eq(i).children().eq(2).children().eq(2).html();
            aa[i] = id;
        }
        var flag = window.checkFlash;
        console.log(typeof(flag));
        var arr = [];
        $("input[type='checkbox']:checked").each(function () {
                  arr.push($(this).val());
                  typeof (toString(arr));
        });
       var  arrs = [];
       arrs[0] = arr[0];
        for (var  i = 1 ;i<arr.length;i++){
           if($.inArray(arr[i],aa) == -1){
               arrs.push(arr[i]);
           }
        }
        if (arrs.length !=1){
        typeof (toString(arrs));
        var  row = $("#chooesPlayerInfos");
         ajax({
                type: "POST",
                url: "${base_path}/team/getAllPlayersByIds",
                dataType: "json",
                data: {"playerids": JSON.stringify(arrs),"flag":flag,"token":$("#token").val()},
                success: function (result) {
                    <fmt:bundle basename="properties.upload">
                    jQuery.each(result.data.players, function(i,item) {
                        var div = $("<div id=\"playerInfos\" class=\"zhazhazha\" ></div>");
                        var img = $("<img class=\"clo\" src=\"${base_path}/<fmt:message key="upload.image.url.prefix"/>/"+item.headPic+"\" style=\"width:78px;height:91px;\">");
                        var  a = $("<a onclick=\"deleteRow($(this),"+item.idPlayer+");\"></a>");
                        var b = $("<b></b>");
                        b.append("x");
                        a.append(b);
                        var nameSpan = $("<span></span>");
                        nameSpan.text(item.name);
                        var playerIdSpan = $("<span id=\"idPlayer\" class='playerId'></span>");
                        //playerIdSpan.text(result.data.players[i].idPlayer);
                        var p = $("<p class=\"muted zhazhahui father\" ></p>");
                        var br = $("<br>");
                        playerIdSpan.text(item.idPlayer);
                        p.append(nameSpan);
                        p.append(br);
                        p.append(playerIdSpan);
                        div.append(img);
                        div.append(a);
                        div.append(p);
                        row.append(div);
                    });
                    </fmt:bundle>
                    window.checkFlash = 0;
                }
            })
    }else {
        }

    }
</script>
<script>
  //删除指定的球员的信息
    function deleteRow(obj,id){
        var playerid = id;
        ajax({
            type: "POST",
            url: "${base_path}/team/deletePlayerById",
            data: {"playerid": id,"token":$("#token").val()},
            success:function (result) {
                if (result.status == 0){
                    obj.parent().remove();
                }
            }
        });

    }

</script>
<script>
  //判断页面是否刷新
    if(window.checkFlash){
        window.checkFlash = 0;
    }else{
        window.checkFlash = 1;
    }
</script>

<script type="text/javascript">


    $(document).ready(function () {
        loadInfo();
    });



    function loadInfo() {
        ajax({
            url:"${base_path}/team/findInfo",
            type:"post",
            dataType:"json",
            data:{"token":$("#token").val(),"idTeam":${sessionScope.idTeam}},
            success:function (result) {
                if (result.status == 0) {
                    var  realType = "";
                    $("#teamName").val(result.data.team.name);
                    var ss = result.data.team.type;
                    $("#teamClazz").children().eq(ss-1).attr("selected","selected");
                    //教练
                    if (result.data.coach != null) {
                        $("#coach_name").text(result.data.coach.name);
                        $("#coachAge").text(result.data.coach.age);
                        /*$("#coachSex").text(result.data.sex);*/
                        if (result.data.coach.sex == 0) {
                            $("#coachSex").text("女");
                        } else {
                            $("#coachSex").text("男");
                        }
                        $("#coach_id").text(result.data.coach.idCoach);
                        coachids = result.data.coach.idCoach;
                    }else {
                        //$("#coachName").text("未添加教练");
                    }
                    //球员
                    var row = $("#chooesPlayerInfos");
                    <fmt:bundle basename="properties.upload">
                    if (result.data.players.length != 0){
                        for (var i = 0; i < result.data.players.length; i++) {
                            var div = $("<div class=\"zhazhazha\" ></div>");
                            var img = $("<img class=\"clo\" src=\"${base_path}/<fmt:message key="upload.image.url.prefix"/>/"+result.data.players[i].headPic+"\" style=\"width:100%;\">");
                            var  a = $("<a class='a'></a>");
                            var b = $("<b></b>");
                            b.append("x");
                            a.append(b);
                            var nameSpan = $("<span></span>");
                            nameSpan.text(result.data.players[i].name);
                            var playerIdSpan = $("<span id=\"idPlayer\" class='playerId'></span>");
                            playerIdSpan.text(result.data.players[i].idPlayer);
                            var p = $("<p class=\"muted zhazhahui father\" ></p>");
                            var br = $("<br>");
                            //playerIdSpan.text(result.data.players[i].idPlayer);
                            p.append(nameSpan);
                            p.append(br);
                            p.append(playerIdSpan);
                            div.append(img);
                            div.append(a);
                            div.append(p);
                            row.append(div);
                        }
                    }else if (result.status == 1){
                        //row.append("<p style='color: red'>未添加球员</p>");
                        msg("服务器异常，请刷新");
                    }
                    </fmt:bundle>

                }
            }
        });
    }

    $("#chooesPlayerInfos").on('click','.a',function(){
        var playerId = $(this).parent().children().eq(2).children().eq(2).text();
        layer.confirm('确认删除球员吗？',{ btn: ['确定', '取消']},
            function (index) {
                ajax({
                    url:"${base_path}/team/deletePlayer",
                    type:"post",
                    dataType:"json",
                    data:{"idTeam":${sessionScope.idTeam},"playerId":playerId,"token":$("#token").val()},
                    success:function (result) {
                        if (result.status ==0) {
                            $(this).parent().remove();
                            $(".rowPlayer").empty();
                            layer.msg("删除成功！");
                        }else if (result.status == 1){
                            layer.msg("删除失败");
                        }
                        setTimeout(function () {
                            window.location.reload();
                        },800);

                    },
                    error:function (error) {
                        console.log(error);
                    }
                })
            }),
            function () {
                layer.alert("取消成功");
            }


    });

    $("#close").click(function () {
        $("#chooesPlayerInfos").empty();
        window.loadInfo();
    })




</script>






</body>

</html>
