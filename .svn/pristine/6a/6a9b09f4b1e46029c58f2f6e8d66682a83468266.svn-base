<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<html>
<head>
    <title>机构注册</title>
    <link rel="stylesheet" type="text/css" href="${path}/resources/lib/bootstrap/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="${path}/resources/css/player/style.1.0.css"/>

</head>
<body>
<div class="or-bg">
    <form class="container" id="register1" method="post">
        <div class="row">
            <div class="col-xs-6 col-xs-offset-3">
                <div class="login_bg text-center">
                    <!--注册面板标题-->
                    <br>
                    <div class="logo-w2 col-xs-10 col-xs-offset-1 form-group">
                        <!--<img src="img/logo足球项目组.png">-->
                        <span class="title" style="color: green; font-size: 25px;">四川省青少年足球信息化</span>
                    </div>
                    <div class="logo-w2 col-xs-10 col-xs-offset-1 form-group">
                        <span class="title" style="color: green; font-size: 22px;">————机构注册————</span>
                    </div>
                    <!--注册面板表单-->
                    <div class="form-horizontal" role="form">
                        <!--地区-->
                        <div class="input-icon-group">
                            <div class="col-xs-8 col-xs-offset-2 input-group">
                                <div class="input-group" style="width: 100%">
                                    <select class="select2" id="city" name="countryCode">
                                        <option value="">选择市</option>
                                    </select>
                                    <select class="select2" id="area" name="villageCode" onblur="getOrg();return false;">
                                        <option value="">选择县</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <br>
                        <!--学校信息-->
                        <div class="input-icon-group">
                            <div class="col-xs-8 col-xs-offset-2 input-group">
                                <div class="input-group" style="width: 100%">
                                    <select class="select1" id="school"  name="schoolCode">
                                        <option value="0">选择学校</option>
                                        <c:forEach var="org" items="${orgList}" >
                                            <option value="${org.schoolCode}">${org.name}</option>
										</c:forEach>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <br>
                        <!--输入密码-->
                        <div class="input-icon-group">
                            <div class="col-xs-8 col-xs-offset-2 input-group">
                                <span class="input-group-addon">
                                    <i class="glyphicon glyphicon-lock"></i>
                                </span>
                                <div class="input-group" style="width: 100%">
                                    <input id="password1" class="form-control" name="password"  placeholder="请输入密码：6至20位" maxlength="20" minlength="6" type="password" >
                                </div>
                                <div class="col-xs-2">
                                    <span class="passwordInfo"></span>
                                </div>
                            </div>
                            <span id="tsk" style="color: red">密码输入位数错误</span>
                        </div>
                        <!--确认密码-->
                        <div class="input-icon-group">
                            <div class="col-xs-8 col-xs-offset-2 input-group">
                                <span class="input-group-addon">
                                    <i class="glyphicon glyphicon-lock"></i>
                                </span>
                                <div class="input-group" style="width: 100%">
                                    <input id="password2" class="form-control" name="password2"  placeholder="请再次输入密码：6至20位" maxlength="20" type="password" >
                                </div>
                                <div class="col-xs-2">
                                    <span class="passwordInfo"></span>
                                </div>
                            </div>
                            <span id="qrts" style="color: red">密码输入不正确</span>
                        </div>

                        <!--输入电话号码-->
                        <div class="input-icon-group">
                            <div class="col-xs-8 col-xs-offset-2 input-group">
                                <span class="input-group-addon">
                                    <i class="glyphicon glyphicon-earphone"></i>
                                </span>
                                <div class="input-group" style="width: 100%">
                                    <input id="phone" class="col-xs-6 form-control" placeholder="请输入电话号码" maxlength="11" type="text" name="phone">
                                </div>
                            </div>
                            <span id="sjts" style="color: red">输入的手机号错误</span>
                        </div>
                        <!--图片验证-->
                        <div class="input-icon-group " >
                            <div class="col-xs-4 col-xs-offset-2 input-group" style="float: left">
                                <div class="input-group" style="width: 100%;padding-bottom: 16px;">
                                    <span class="input-group-addon"><span class="glyphicon glyphicon-qrcode"></span></span>
                                    <input id="idcode-btn" class="form-control" placeholder="验证码" maxlength="6" minlength="6" type="text" name="yzm">
                                </div>
                            </div>
                            <div style="float: left ;width: 30%;height: 34px;margin-left: 10px; cursor: pointer" class="col-xs-4">
                                <!--验证码图片-->
                                <img src="${base_path}/imageCode" onclick="getCode()" id="checkimagecode">
                            </div>
                        </div>
                        <br>

                        <div class="form-group">
                            <div class="col-xs-8" style="width: 100%">
                                <button class="btn1 btn-success form-group" type="button" onclick="doSubmit();return false;">注册</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <input type="hidden" id="token" value="${token}">
</div>
<script src="${path}/resources/lib/jquery/jquery-3.1.1.min.js"></script>
<script src="${path}/resources/lib/bootstrap/bootstrap.min.js"></script>
<script src="${path}/resources/lib/jquery/jquery-1.11.3.js"></script>
<script src="${path}/resources/js/player/OrganizationRegist.js"></script>
<script src="${path}/resources/js/player/District.js"></script>
<script src="${path}/resources/lib/layer/layer.js"></script>
<script src="${path}/resources/js/index.js"></script>
<script type="text/javascript">
    function getOrg(){
            var countryCode = $("#city option:selected").val();
            var villageCode = $("#area option:selected").val();

            ajax({
                type: "POST",   //提交的方法
                url:"/organization/showorg", //提交的地址
                data:{
                    "countrycode":countryCode,
                    "villagecode":villageCode
                },
                dataType:'json',
                success: function(data) {  //成功
                    $("#school").empty();
                    //$("#school").append("<option value='"+""+"'>"+"选择学校"+"</option>");
                    $.each( data.data.OrgList,function(index,item){
                        $("#school").append("<option value='"+item.schoolCode+"'>"+item.name+"</option>");
                    });

                },
                error: function(data) {  //失败的话
                    console.log(data);
                }
            });
        }
        function doSubmit() {
            ajax({
                type: "POST",   //提交的方法
                url:"/organization/register1", //提交的地址
                data:$('#register1').serialize(),// 序列化表单值
                dataType:'json',
                success: function(data) {  //成功
                    console.log(data);
                    //就将返回的数据显示出来
                    switch (data.status){
                        case 0:
                            layer.msg("注册成功，请登录");
                            window.location.href="${path}/player/list";
                            break;
                        case 1:
                            layer.msg("密码或验证码输入错误");
                            break;
                        case 12:
                            layer.msg("验证码输入错误");
                            break;
                        case 21:
                            layer.msg("非法字符、位数、格式等其他错误");
                            break;
                        case 22:
                            layer.msg("机构已经注册，请登录");
                            break;
                    }
                },
                error: function(data) {  //失败的话
                    console.log(data);
                }
            });
    }
    function getCode()
    {
        $("#idcode-btn").val("");
        $("#checkimagecode").attr('src',"${path}/imageCode?abc="+Math.random())//MAth.random是为了避免缓冲
    }
</script>
</body>
</html>
