<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<%--
  Created by IntelliJ IDEA.
  User: inkbox
  Date: 18-3-21
  Time: 下午3:43
  To change this template use File | Settings | File Templates.
--%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<c:set var="path" value="${pageContext.request.contextPath}"/>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1.0, user-scalable=0">
    <title>裁判报告书</title>
    <link rel="stylesheet" type="text/css" href="${path}/resources/lib/bootstrap/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="${path}/resources/css/referee/public.css"/>
    <link rel="stylesheet" type="text/css" href="${path}/resources/css/referee/report.css"/>
    <link rel="stylesheet" type="text/css" href="${path}/resources/css/referee/lCalendar.css"/>
</head>

<body>
<!--导航-->
<nav class="nav-bg navbar">
    <div class="container">
        <div class="logo-w col-lg-4 col-md-5 col-sm-11 col-xs-12">
            <img src="${path}/resources/img/logo.png"/>
            <span>四川省青少年校园足球信息网</span>
        </div>
    </div>
</nav>

<!--内容-->
<div class="panel panel-info">
    <div class="panel-heading text-center">
        <h3 class="panel-title">裁判报告书</h3>
    </div>
    <div class="panel-body">
        <!--赛事内容-->
        <div class="panel panel-default">
            <div class="panel-heading text-center">
                赛事内容
            </div>
            <div class="panel-body">
                <div class="container">
                    <div class="row">
                        <div class="col-xs-4">赛事名称：</div>
                        <div class="col-xs-8 text-center">${match.name}</div>
                    </div>
                    <div class="row">
                        <div class="col-xs-4">参赛队伍：</div>
                        <div class="col-xs-3 text-center">主队：</div>
                        <div class="col-xs-5 text-center">${schedule.teamA.name}</div>
                    </div>
                    <div class="row text-center">
                        <div class="col-xs-3 col-xs-offset-4">客队：</div>
                        <div class="col-xs-5">${schedule.teamB.name}</div>
                    </div>
                    <div class="row">
                        <div class="col-xs-5">比赛开始时间：</div>
                        <div class="col-xs-7 text-center"><fmt:formatDate
                                value="${schedule.scheduleInformation.beginTime}" pattern="yyyy/MM/dd HH:mm"/></div>
                    </div>
                </div>
            </div>
        </div>
        <!--比赛情况-->
        <div class="panel panel-default">
            <div class="panel-heading text-center">
                比赛情况
            </div>
            <div class="panel-body">
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12">常规赛比分：</div>
                    </div>
                    <div class="row text-center">
                        <div class="col-xs-4">${schedule.teamA.name}</div>
                        <div class="col-xs-1">VS</div>
                        <div class="col-xs-4">${schedule.teamB.name}</div>
                        <div class="col-xs-1">${schedule.scheduleInformation.goalA}</div>
                        <div class="col-xs-1">：</div>
                        <div class="col-xs-1">${schedule.scheduleInformation.goalB}</div>
                    </div>
                    <%--<div class="row">--%>
                    <%--<div class="col-xs-12">加时赛比分：</div>--%>
                    <%--</div>--%>
                    <%--<div class="row text-center">--%>
                    <%--<div class="col-xs-4 ">${schedule.teamA.name}</div>--%>
                    <%--<div class="col-xs-1 ">VS</div>--%>
                    <%--<div class="col-xs-4 ">${schedule.teamB.name}</div>--%>
                    <%--<div class="col-xs-1 ">--%>
                    <%--<input type="text" class="input-score" placeholder="00" />--%>
                    <%--</div>--%>
                    <%--<div class="col-xs-1 ">：</div>--%>
                    <%--<div class="col-xs-1 ">--%>
                    <%--<input type="text" class="input-score" placeholder="00"/>--%>
                    <%--</div>--%>
                    <%--</div>--%>
                    <%--<div class="row">--%>
                    <%--<div class="col-xs-12">点球决胜结果：</div>--%>
                    <%--</div>--%>
                    <%--<div class="row text-center">--%>
                    <%--<div class="col-xs-4 ">${schedule.teamA.name}</div>--%>
                    <%--<div class="col-xs-1 ">VS</div>--%>
                    <%--<div class="col-xs-4 ">${schedule.teamB.name}</div>--%>
                    <%--<div class="col-xs-1 ">--%>
                    <%--<input type="text" class="input-score" placeholder="00"/>--%>
                    <%--</div>--%>
                    <%--<div class="col-xs-1 ">：</div>--%>
                    <%--<div class="col-xs-1 ">--%>
                    <%--<input type="text" class="input-score" placeholder="00"/>--%>
                    <%--</div>--%>
                    <%--</div>--%>

                    <div class="row">
                        <div class="col-xs-4">获胜队：</div>
                        <div class="col-xs-8">
                            <c:choose>
                                <c:when test="${schedule.scheduleInformation.goalA>schedule.scheduleInformation.goalB}">
                                    ${schedule.teamA.name}
                                </c:when>
                                <c:when test="${schedule.scheduleInformation.goalA<schedule.scheduleInformation.goalB}">
                                    ${schedule.teamB.name}
                                </c:when>
                                <c:otherwise>平局</c:otherwise>
                            </c:choose>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--参赛队员名单-->
        <div class="panel panel-default">
            <div class="panel-heading text-center">
                首发队员名单
            </div>
            <div class="panel-body">
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12">${schedule.teamA.name}：</div>
                    </div>
                </div>
                <table class="table table-bordered" id="firstMaster">
                    <thead>
                    <tr class="warning">
                        <th>队员姓名</th>
                        <th>位置</th>
                        <th>球衣号码</th>
                        <th>
                            <input type="button" id="" class="btn btn-warning btn-xs center-block tr-add" value="添加"/>
                        </th>
                    </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>

                <div class="container">
                    <div class="row">
                        <div class="col-xs-12">${schedule.teamB.name}：</div>
                    </div>
                </div>
                <table class="table table-bordered " id="firstServant">
                    <thead>
                    <tr class="warning">
                        <th>队员姓名</th>
                        <th>位置</th>
                        <th>球衣号码</th>
                        <th>
                            <input type="button" id="" class="btn btn-warning btn-xs center-block  tr-add" value="添加"/>
                        </th>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
        <!--替补队员名单-->
        <div class="panel panel-default">
            <div class="panel-heading text-center">
                替补队员名单
            </div>
            <div class="panel-body">
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12">${schedule.teamA.name}：</div>
                    </div>
                </div>
                <table class="table table-bordered " id="secMaster">
                    <thead>
                    <tr class="warning">
                        <th>进场队员</th>
                        <th>位置</th>
                        <th>号码</th>
                        <th>时间</th>
                        <th>
                            <input type="button" class="btn btn-warning btn-xs center-block tr-add" value="添加"/>
                        </th>
                    </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12">${schedule.teamB.name}：</div>
                    </div>
                </div>
                <table class="table table-bordered " id="secServant">
                    <thead>
                    <tr class="warning">
                        <th>进场队员</th>
                        <th>位置</th>
                        <th>号码</th>
                        <th>时间</th>
                        <th>
                            <input type="button" class="btn btn-warning btn-xs center-block tr-add" value="添加"/>
                        </th>
                    </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
            </div>
        </div>
        <!--进球队员-->
        <div class="panel panel-default">
            <div class="panel-heading text-center">
                进球队员
            </div>
            <div class="panel-body">
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12">${schedule.teamA.name}：</div>
                    </div>
                </div>
                <table class="table table-bordered " id="scoreMaster">
                    <thead>
                    <tr class="warning">
                        <th>姓名</th>
                        <th>位置</th>
                        <th>号码</th>
                        <th>时间</th>
                        <th>
                            <input type="button" class="btn btn-warning btn-xs center-block tr-add " value="添加"/>
                        </th>
                    </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12">${schedule.teamB.name}：</div>
                    </div>
                </div>
                <table class="table table-bordered " id="scoreServant">
                    <thead>
                    <tr class="warning">
                        <th>姓名</th>
                        <th>位置</th>
                        <th>号码</th>
                        <th>时间</th>
                        <th>
                            <input type="button" class="btn btn-warning btn-xs center-block tr-add" value="添加"/>
                        </th>
                    </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
            </div>
        </div>
        <!--警告队员名单-->
        <div class="panel panel-default">
            <div class="panel-heading text-center">
                警告队员名单
            </div>
            <div class="panel-body">
                <table class="table table-bordered " id="warning">
                    <thead>
                    <tr class="warning">
                        <th>队伍</th>
                        <th>队员姓名</th>
                        <th>号码</th>
                        <th>时间</th>
                        <th>原因</th>
                        <th>
                            <input type="button" class="btn btn-warning btn-xs center-block tr-add" value="添加"/>
                        </th>
                    </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
            </div>
        </div>
        <!--罚令出场名单-->
        <div class="panel panel-default">
            <div class="panel-heading text-center">
                罚令出场名单
            </div>
            <div class="panel-body">
                <table class="table table-bordered " id="punish">
                    <thead>
                    <tr class="warning">
                        <th>队伍</th>
                        <th>队员姓名</th>
                        <th>号码</th>
                        <th>时间</th>
                        <th>原因</th>
                        <th>
                            <input type="button" class="btn btn-warning btn-xs center-block tr-add" value="添加"/>
                        </th>
                    </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
            </div>
        </div>
        <!--红牌情况说明-->
        <div class="panel panel-default">
            <div class="panel-heading text-center">
                红牌情况说明
            </div>
            <div class="panel-body">
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12">
                            <textarea class="form-control" rows="3" id="redDes"
                                      placeholder="请输入本场比赛红牌情况，不超过100字（选填）"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--罚球点球情况说明-->
        <div class="panel panel-default">
            <div class="panel-heading text-center">
                罚球点球情况说明
            </div>
            <div class="panel-body">
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12">
                            <textarea class="form-control" rows="3" id="punishDes"
                                      placeholder="请输入本场比赛罚球点球情况，不超过100字（选填）"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--严重错漏判情况说明-->
        <div class="panel panel-default">
            <div class="panel-heading text-center">
                严重错漏判情况说明
            </div>
            <div class="panel-body">
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12">
                            <textarea class="form-control" rows="3" id="missDes"
                                      placeholder="请输入本场比赛严重错漏判情况，不超过100字（选填）"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--底部-->
        <div class="container">
            <div class="row text-center">
                <div class="col-xs-6">裁判员姓名：</div>
                <div class="col-xs-6">${name}</div>
            </div>
            <div class="row text-center">
                <div class="col-xs-6">裁判员电话：</div>
                <div class="col-xs-6">${phone}</div>
            </div>
            <div>
                <input class="btn btn-success btn-md radius center-block panel-distance" id="submit" type="button"
                       value="提交">
            </div>
        </div>

    </div>
    <!--添加页面-->
    <!--<div class="panel panel-info " id="add-page"  >-->
    <div class="panel panel-info add-page" id="add-page">
        <div class="panel-heading">
            <h3 class="panel-title text-center">
                添加信息
            </h3>
        </div>
        <div class="panel-body">
            <div class="container text-center">

                <div class="row">
                    <div class="col-xs-4 col-xs-offset-1 text-right" style="background-color: #FDF5E6; ">队伍：</div>
                    <div class="col-xs-6">
                        <select class="input-write" id="select-team">
                            <option value="${schedule.scheduleInformation.teamA}">${schedule.teamA.name}</option>
                            <option value="${schedule.scheduleInformation.teamB}">${schedule.teamB.name}</option>
                        </select>
                    </div>
                </div>

                <div class="row" style="margin-top: 15px;">
                    <div class="col-xs-4 col-xs-offset-1 text-right" style="background-color: #FDF5E6;">队员姓名：</div>
                    <div class="col-xs-6">
                        <select class="input-write" id="select-name">
                            <c:forEach var="item" items="${players}">
                                <option value="${item.playerId}" team="${item.teamId}">${item.name}</option>
                            </c:forEach>
                        </select>
                    </div>
                </div>

                <div class="row" style="margin-top: 15px;">
                    <div class="col-xs-4 col-xs-offset-1 text-right" style="background-color: #FDF5E6;">位置：</div>
                    <div class="col-xs-6">
                        <select class="input-write" id="select-place">
                            <option value="1">守门员</option>
                            <option value="2">后卫</option>
                            <option value="3">中场</option>
                            <option value="4">前锋</option>
                        </select>
                    </div>
                </div>

                <div class="row" style="margin-top: 15px;">
                    <div class="col-xs-4 col-xs-offset-1 text-right" style="background-color: #FDF5E6;">球衣号码：</div>
                    <div class="col-xs-6">
                        <input type="number" id="shirt-num" class="input-write input-width" value=""/>
                    </div>
                </div>

                <div class="row" style="margin-top: 15px;" id="date">
                    <div class="col-xs-4 col-xs-offset-1 text-right" style="background-color: #FDF5E6;">时间：</div>
                    <div class="col-xs-6">
                        <!--<input type="text" id="time" class="input-write input-width" value="" />-->
                        <input id="demo3" type="text" name="input_date" class="input-write input-width"/>
                    </div>
                </div>

                <div class="row" style="margin-top: 15px;" id="reasonRow">
                    <div class="col-xs-4 col-xs-offset-1 text-right" style="background-color: #FDF5E6;">原因：</div>
                    <div class="col-xs-6">
                        <input type="text" id="reason" placeholder="选填" class="input-write input-width" value=""/>
                    </div>
                </div>

                <div class="row" style="margin-top: 15px;">
                    <div class="col-xs-12 font-color invisible" id="prompt" style="color: red; visibility: hidden;">
                        信息不完整
                    </div>
                </div>


                <div class="row" style="margin-top: 15px;">
                    <div class="col-xs-4 col-xs-offset-2" style="">
                        <input type="button" class="btn btn-success btn-sm radius center-block" id="confim" value="确认"/>
                    </div>
                    <div class="col-xs-4">
                        <input type="button" class="btn btn-danger btn-sm radius center-block" id="cancel" value="取消"/>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <input type="hidden" id="token" value="${token}">
</div>

<!--<div id="mask"></div>-->

<script src="${path}/resources/lib/jquery/jquery-3.1.1.min.js"></script>
<script src="${path}/resources/lib/bootstrap/bootstrap.min.js"></script>
<script src="${path}/resources/lib/layer_mobile/layer.js"></script>
<script src="${path}/resources/js/index.js"></script>
<script src="${path}/resources/js/referee/lCalendar.js"></script>
<script src="${path}/resources/js/referee/report.js"></script>
<script type="text/javascript">
    $(function () {
        function transDate(value) {
            if (value === '') {
                return new Date();
            }
            var split = value.split(':');
            var date = new Date();
            date.setHours(parseInt(split[0]));
            date.setMinutes(parseInt(split[1]));
            return date;
        }


        function getPlayDes() {
            var players = [];
            var $trs = $('#firstMaster>tbody>tr');
            //主队出场球员
            for (var i = 0; i < $trs.length; i++) {
                var item = {};
                var $tr = $trs.eq(i);
                item.teamId = $tr.attr('teamId');
                item.playerId = $tr.attr('playerId');
                item.name = $tr.find('td:eq(0)').html().trim();
                item.position = $tr.find('td:eq(1)').html().trim();
                item.number = $tr.find('td:eq(2)').html().trim();
                item.type = 1;
                players.push(item);
            }
            //客队首发球员
            $trs = $('#firstServant>tbody>tr');
            for (var i = 0; i < $trs.length; i++) {
                var item = {};
                var $tr = $trs.eq(i);
                item.teamId = $tr.attr('teamId');
                item.playerId = $tr.attr('playerId');
                item.name = $tr.find('td:eq(0)').html().trim();
                item.position = $tr.find('td:eq(1)').html().trim();
                item.number = $tr.find('td:eq(2)').html().trim();
                item.type = 1;
                players.push(item);
            }

            //主队替补球员
            $trs = $('#secMaster>tbody>tr');
            for (var i = 0; i < $trs.length; i++) {
                var item = {};
                var $tr = $trs.eq(i);
                item.teamId = $tr.attr('teamId');
                item.playerId = $tr.attr('playerId');
                item.name = $tr.find('td:eq(0)').html().trim();
                item.position = $tr.find('td:eq(1)').html().trim();
                item.number = $tr.find('td:eq(2)').html().trim();
                item.date = transDate($tr.find('td:eq(3)').html().trim());
                item.type = 2;
                players.push(item);
            }
            //客队替补球员
            $trs = $('#secServant>tbody>tr');
            for (var i = 0; i < $trs.length; i++) {
                var item = {};
                var $tr = $trs.eq(i);
                item.teamId = $tr.attr('teamId');
                item.playerId = $tr.attr('playerId');
                item.name = $tr.find('td:eq(0)').html().trim();
                item.position = $tr.find('td:eq(1)').html().trim();
                item.number = $tr.find('td:eq(2)').html().trim();
                item.date = transDate($tr.find('td:eq(3)').html().trim());
                item.type = 2;
                players.push(item);
            }
            //主队进球球员
            $trs = $('#scoreMaster>tbody>tr');
            for (var i = 0; i < $trs.length; i++) {
                var item = {};
                var $tr = $trs.eq(i);
                item.teamId = $tr.attr('teamId');
                item.playerId = $tr.attr('playerId');
                item.name = $tr.find('td:eq(0)').html().trim();
                item.position = $tr.find('td:eq(1)').html().trim();
                item.number = $tr.find('td:eq(2)').html().trim();
                item.date = transDate($tr.find('td:eq(3)').html().trim());
                item.type = 3;
                players.push(item);
            }
            //客队进球球员
            $trs = $('#scoreServant>tbody>tr');
            for (var i = 0; i < $trs.length; i++) {
                var item = {};
                var $tr = $trs.eq(i);
                item.teamId = $tr.attr('teamId');
                item.playerId = $tr.attr('playerId');
                item.name = $tr.find('td:eq(0)').html().trim();
                item.position = $tr.find('td:eq(1)').html().trim();
                item.number = $tr.find('td:eq(2)').html().trim();
                item.date = transDate($tr.find('td:eq(3)').html().trim());
                item.type = 3;
                players.push(item);
            }
            //警告球员
            $trs = $('#warning>tbody>tr');
            for (var i = 0; i < $trs.length; i++) {
                var item = {};
                var $tr = $trs.eq(i);
                item.teamId = $tr.attr('teamId');
                item.playerId = $tr.attr('playerId');
                item.name = $tr.find('td:eq(1)').html().trim();
                item.number = $tr.find('td:eq(2)').html().trim();
                item.date = transDate($tr.find('td:eq(3)').html().trim());
                item.other = $tr.find('td:eq(4)').html();
                item.type = 4;
                players.push(item);
            }
            //罚令球员
            $trs = $('#punish>tbody>tr');
            for (var i = 0; i < $trs.length; i++) {
                var item = {};
                var $tr = $trs.eq(i);
                item.teamId = $tr.attr('teamId');
                item.playerId = $tr.attr('playerId');
                item.name = $tr.find('td:eq(1)').html().trim();
                item.number = $tr.find('td:eq(2)').html().trim();
                item.date = transDate($tr.find('td:eq(3)').html().trim());
                item.other = $tr.find('td:eq(4)').html();
                item.type = 5;
                players.push(item);
            }

            return players;
        }



        $('#submit').click(function () {
            var players = getPlayDes();
            console.log(players)
            if (players.length === 0) {
                msg('您没有添加任何一个球员')
            } else {
                layer.open({
                    content: '您确定要提交裁判报告书？'
                    , btn: ['确定', '取消']
                    , yes: function (index) {
                        layer.close(index);
                        //获取
                        ajax({
                            url: '',
                            type: 'post',
                            dataType: 'json',
                            data: {
                                playerJson: JSON.stringify(players),
                                redDes: $('#redDes').val().trim(),
                                punishDes: $('#punishDes').val().trim(),
                                missDes: $('#missDes').val().trim(),
                                token: $('#token').val()
                            },
                            success: function (result) {
                                $('#token').val(result.token);
                                switch (result.status) {
                                    case 0:
                                        msg('提交成功，比赛结束')
                                        $('#token').val('');
                                        break;
                                    case 1:
                                        msg('提交失败，请重试');
                                        break;
                                }

                            }
                        })
                    }
                });
            }
        });
    })
</script>
</body>
</html>




