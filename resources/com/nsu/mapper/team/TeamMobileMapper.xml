<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nsu.dao.team.TeamMobileDao">

<!-- 查询球队id-->	
	<select id="findTeamIDByAID" parameterType="java.lang.String" resultType="java.lang.String" >
		SELECT TEAM_ID FROM TEAM WHERE A_ID=#{aid} AND TEAM_STATUS=1 limit 1
	</select>
	
<!-- 根据球队id查询已经结束的比赛信息 -->	
	<select id="findTeamMatchesInfo" parameterType="java.lang.String" resultType="com.nsu.bean.team.TeamMobileResultBean" >
		SELECT COM_ID comID, COM_NAME comName FROM COMPETITION_NOTICE
			WHERE COM_STATUS=1 AND 0>(COM_END-NOW()) AND COM_ID IN(SELECT COM_ID FROM MID_TEAM_COM 
												WHERE TEAM_ID=#{teamID} AND TEAM_COM_STATUS=1)
	</select>
	
<!-- 根据球队id查询正在进行的比赛信息 -->	
	<select id="findTeamMatchesIsPlayingInfo" parameterType="java.lang.String" resultType="com.nsu.bean.team.TeamMobileResultBean" >
		SELECT COM_ID comID, COM_NAME comName FROM COMPETITION_NOTICE
			WHERE COM_STATUS=1 AND (COM_END-NOW())>=0 AND COM_ID IN(SELECT COM_ID FROM MID_TEAM_COM 
												WHERE TEAM_ID=#{teamID} AND TEAM_COM_STATUS=1)
	</select>	
	
<!-- 根据赛事ID和球队ID查询赛程信息	 -->
	<select id="findRaceDetailsInfo" parameterType="java.lang.String" resultType="java.util.Map" >
		SELECT * FROM
			(SELECT R_ID rID, COM_ID comID,  date_format(R_START_TIME, '%Y-%c-%e %k:%i') sTime, date_format(R_END_TIME, '%Y-%c-%e %k:%i') eTime, R_H_TEAM_ID rHTeamID, R_V_TEAM_ID rVTeamID, 
				(SELECT TEAM.TEAM_NAME FROM TEAM WHERE TEAM_ID=R_V_TEAM_ID AND TEAM_STATUS=1) rVTeamName,
				(SELECT TEAM.TEAM_NAME FROM TEAM WHERE TEAM_ID=R_H_TEAM_ID AND TEAM_STATUS=1) rHTeamName,
				(SELECT TEAM.TEAM_BADGE FROM TEAM WHERE TEAM_ID=R_V_TEAM_ID AND TEAM_STATUS=1) rVTeamBadge,
				(SELECT TEAM.TEAM_BADGE FROM TEAM WHERE TEAM_ID=R_H_TEAM_ID AND TEAM_STATUS=1) rHTeamBadge
			FROM RACE_DETAILS 
			WHERE R_STATUS=1 AND COM_ID=#{comID} AND (R_H_TEAM_ID=#{teamID} OR R_V_TEAM_ID=#{teamID}))
		S
	</select>
	
</mapper> 