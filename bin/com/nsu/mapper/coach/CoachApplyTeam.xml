<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nsu.dao.coach.CoachApplyTeamDao">
	<!-- 通过教练员ID获取当前提交过申请的球队的条数 -->
	<select id="getApplyedTeamsTotal" resultType="java.lang.Integer">
		Select count(TEAM.TEAM_ID)
		FROM
		TEAM
		JOIN TEAM_SCORE ON TEAM.TEAM_ID=TEAM_SCORE.TEAM_ID
		JOIN MID_COACH_TEAM
		ON MID_COACH_TEAM.TEAM_ID=TEAM.TEAM_ID
		WHERE
		MID_COACH_TEAM.COACH_ID=#{coachID} and COACH_TEAM_STATSU != 3 
	</select>
	<select id="getApplyTeamsInfo" resultType="java.util.HashMap">
		Select TEAM_NAME,
		TEAM.TEAM_ID,
		TEAM.TEAM_BADGE,
		TEAM.TEAM_REGION,
		MID_COACH_TEAM.TIME,
		TEAM.TEAM_AFFILIATION,
		TEAM.TEAM_RANK,
		MID_COACH_TEAM.COACH_TEAM_STATSU,
		(TS_SCHOOL_VICTOR+TS_SCHOOL_DRAW+TS_SCHOOL_LOSE+TS_COUNTRY_VICTOR+TS_COUNTRY_DRAW
		+TS_COUNTRY_LOSE+TS_CITY_VICTOR+TS_CITY_DRAW+TS_CITY_LOSE+TS_PROVINCE_VICTOR+TS_PROVINCE_DRAW+TS_PROVINCE_LOSE+TS_OTHER_WIN+TS_OTHER_LOSS+TS_OTHER_ALL
		) as MATCH_NUM,
		CONCAT(FORMAT(round((TS_SCHOOL_VICTOR+TS_COUNTRY_VICTOR+TS_CITY_VICTOR+TS_PROVINCE_VICTOR+TS_OTHER_WIN)
		/
		(TS_SCHOOL_VICTOR+TS_SCHOOL_DRAW+TS_SCHOOL_LOSE+TS_COUNTRY_VICTOR+TS_COUNTRY_DRAW
		+TS_COUNTRY_LOSE+TS_CITY_VICTOR+TS_CITY_DRAW+TS_CITY_LOSE+TS_PROVINCE_VICTOR+TS_PROVINCE_DRAW+TS_PROVINCE_LOSE+TS_OTHER_WIN+TS_OTHER_LOSS+TS_OTHER_ALL
		), 4)*100,2),"%")AS WINNING_RATIO,
		(TS_SCHOOL_VICTOR*3+TS_SCHOOL_DRAW*2+TS_SCHOOL_LOSE+TS_COUNTRY_VICTOR*3+TS_COUNTRY_DRAW*2
		+TS_COUNTRY_LOSE+TS_CITY_VICTOR*3+TS_CITY_DRAW*2+TS_CITY_LOSE+TS_PROVINCE_VICTOR*3+TS_PROVINCE_DRAW*2+TS_PROVINCE_LOSE+TS_OTHER_WIN*3+TS_OTHER_LOSS+TS_OTHER_ALL*2)
		as SCORE
		FROM
		TEAM
		JOIN TEAM_SCORE ON TEAM.TEAM_ID=TEAM_SCORE.TEAM_ID
		JOIN MID_COACH_TEAM
		ON MID_COACH_TEAM.TEAM_ID=TEAM.TEAM_ID
		WHERE
		MID_COACH_TEAM.COACH_ID=#{coachID}    ORDER BY MID_COACH_TEAM.TIME DESC limit #{index},#{size}
	</select>

	<select id="getApplyTeamInfo" resultType="map">
		Select DISTINCT TEAM_NAME,
		TEAM.TEAM_ID,
		TEAM_BADGE,
		TEAM_REGION,
	    TEAM_AFFILIATION,
		(TS_SCHOOL_VICTOR+TS_SCHOOL_DRAW+TS_SCHOOL_LOSE+TS_COUNTRY_VICTOR+TS_COUNTRY_DRAW
		+TS_COUNTRY_LOSE+TS_CITY_VICTOR+TS_CITY_DRAW+TS_CITY_LOSE+TS_PROVINCE_VICTOR+TS_PROVINCE_DRAW+TS_PROVINCE_LOSE+TS_OTHER_WIN+TS_OTHER_LOSS+TS_OTHER_ALL
		) as MATCH_NUM,
		CONCAT(FORMAT(round((TS_SCHOOL_VICTOR+TS_COUNTRY_VICTOR+TS_CITY_VICTOR+TS_PROVINCE_VICTOR+TS_OTHER_WIN)
		/
		(TS_SCHOOL_VICTOR+TS_SCHOOL_DRAW+TS_SCHOOL_LOSE+TS_COUNTRY_VICTOR+TS_COUNTRY_DRAW
		+TS_COUNTRY_LOSE+TS_CITY_VICTOR+TS_CITY_DRAW+TS_CITY_LOSE+TS_PROVINCE_VICTOR+TS_PROVINCE_DRAW+TS_PROVINCE_LOSE+TS_OTHER_WIN+TS_OTHER_LOSS+TS_OTHER_ALL
		), 4)*100,2),"%")AS WINNING_RATIO,
		(TS_SCHOOL_VICTOR*3+TS_SCHOOL_DRAW*2+TS_SCHOOL_LOSE+TS_COUNTRY_VICTOR*3+TS_COUNTRY_DRAW*2
		+TS_COUNTRY_LOSE+TS_CITY_VICTOR*3+TS_CITY_DRAW*2+TS_CITY_LOSE+TS_PROVINCE_VICTOR*3+TS_PROVINCE_DRAW*2+TS_PROVINCE_LOSE+TS_OTHER_WIN*3+TS_OTHER_LOSS+TS_OTHER_ALL*2)
		as SCORE
		FROM
		TEAM
		LEFT JOIN TEAM_SCORE ON TEAM.TEAM_ID=TEAM_SCORE.TEAM_ID
		WHERE
		TEAM.TEAM_NUM=#{teamNum} and TEAM.TEAM_STATUS=1
	</select>
	<select id="coachApplyTeamStatus" resultType="java.lang.String">
		select MID_COACH_TEAM.COACH_TEAM_ID from MID_COACH_TEAM
		where COACH_ID=#{coachID} and TEAM_ID=#{teamID} and (COACH_TEAM_STATSU=0 OR
		COACH_TEAM_STATSU=1)
	</select>
	
	<insert id="coachApplyTeam">
		INSERT INTO MID_COACH_TEAM (COACH_ID,TEAM_ID,COACH_TEAM_STATSU,TIME) VALUES (#{coachID},#{teamID},0,SYSDATE());
	</insert>
	<select id="selectAidByteamID" parameterType="String" resultType="java.util.HashMap">
		select ACCOUNT.A_ID,ACCOUNT.A_NAME from ACCOUNT 
	join TEAM on TEAM.A_id=ACCOUNT.A_ID
	where TEAM.TEAM_ID=#{teamID}
	
	</select>
	<select id="selectcoachNameAndAidBycoachID" parameterType="String" resultType="java.util.HashMap">
select ACCOUNT.A_NAME,ACCOUNT.A_ID from ACCOUNT
	join COACH ON  COACH.A_ID=ACCOUNT.A_ID
	where COACH.COACH_ID=#{coachID}
	</select>
</mapper>